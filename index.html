```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸµ å¤å¤œçƒŸç« | æˆ‘æ°¸è¿œæ˜¯ä½ çš„å¤´å·ç²‰ä¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            height: 100vh;
            color: white;
            touch-action: none;
        }
        
        #canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* ====== éŸ³ä¹å…ç•Œé¢ ====== */
        .voice-room {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mic-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 107, 107, 0.3);
        }
        
        .mic-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: micPulse 2s ease-in-out infinite;
        }
        
        .room-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .room-title {
            font-size: 16px;
            font-weight: bold;
            color: #ffd166;
        }
        
        .room-audience {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* ====== è§’è‰²å¡ç‰‡ ====== */
        .character-cards {
            position: fixed;
            bottom: 120px;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 0 20px;
        }
        
        .character-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            min-width: 150px;
            backdrop-filter: blur(10px);
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        #aobai-card {
            border-color: rgba(255, 107, 107, 0.5);
        }
        
        #aobai-card::before {
            background: linear-gradient(90deg, #ff6b6b, #ff8e53);
        }
        
        #lein-card {
            border-color: rgba(107, 179, 255, 0.5);
        }
        
        #lein-card::before {
            background: linear-gradient(90deg, #6bb3ff, #53c5ff);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .character-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .aobai-avatar {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        }
        
        .lein-avatar {
            background: linear-gradient(45deg, #6bb3ff, #53c5ff);
        }
        
        .character-name {
            font-size: 16px;
            font-weight: bold;
        }
        
        .character-desc {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .mood-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mood-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .mood-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* ====== äº’åŠ¨æŒ‰é’® ====== */
        .interaction-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }
        
        .interaction-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 24px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .interaction-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .interaction-btn:active {
            transform: scale(0.95);
        }
        
        .btn-1 { border: 2px solid #ff6b6b; }
        .btn-2 { border: 2px solid #6bb3ff; }
        .btn-3 { border: 2px solid #ffd166; }
        .btn-4 { border: 2px solid #a663cc; }
        
        .btn-label {
            position: absolute;
            bottom: -25px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            white-space: nowrap;
        }
        
        /* ====== å¯¹è¯æ¡†ç³»ç»Ÿ ====== */
        .dialogue-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 200;
        }
        
        .dialogue-bubble {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            max-width: 280px;
            z-index: 210;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease-out;
            font-size: 14px;
            line-height: 1.4;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .dialogue-bubble.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .dialogue-bubble::before {
            content: '';
            position: absolute;
            bottom: -8px;
            width: 16px;
            height: 16px;
            background: rgba(0, 0, 0, 0.95);
            transform: rotate(45deg);
        }
        
        .dialogue-owner {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .dialogue-content {
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* ====== æ­Œæ›²é¢æ¿ ====== */
        .song-panel {
            position: fixed;
            top: 90px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            z-index: 100;
            min-width: 250px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 107, 107, 0.3);
        }
        
        .current-song {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .song-icon {
            font-size: 24px;
            color: #ff6b6b;
        }
        
        .song-info {
            flex: 1;
        }
        
        .song-title {
            font-size: 16px;
            font-weight: bold;
            color: #ffd166;
            margin-bottom: 5px;
        }
        
        .song-desc {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .song-history {
            max-height: 120px;
            overflow-y: auto;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-item {
            font-size: 12px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
        }
        
        .history-title {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .history-mood {
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* ====== ç‰¹æ®Šæ—¶åˆ» ====== */
        .special-moment {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.95), rgba(255, 142, 83, 0.95));
            color: white;
            padding: 30px;
            border-radius: 20px;
            z-index: 300;
            text-align: center;
            min-width: 300px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(255, 107, 107, 0.3);
        }
        
        .special-moment.show {
            opacity: 1;
        }
        
        .moment-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .moment-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .moment-desc {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        /* ====== çƒŸèŠ±ç‰¹æ•ˆ ====== */
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        /* ====== åŠ¨ç”»å®šä¹‰ ====== */
        @keyframes micPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0); opacity: 0; }
            50% { opacity: 1; transform: translateY(-100px) scale(1); }
            100% { transform: translateY(-200px) scale(0); opacity: 0; }
        }
        
        @keyframes sparkle {
            0% { transform: rotate(0deg) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: rotate(180deg) scale(1); opacity: 0; }
        }
        
        /* ====== æ‰‹æœºç«¯é€‚é… ====== */
        @media (max-width: 768px) {
            .character-cards { 
                flex-direction: column; 
                align-items: center;
                bottom: 160px;
            }
            
            .character-card {
                min-width: auto;
                width: 90%;
                margin-bottom: 10px;
            }
            
            .interaction-panel { 
                flex-wrap: wrap; 
                justify-content: center;
                bottom: 20px;
                gap: 10px;
            }
            
            .interaction-btn { 
                width: 50px; 
                height: 50px; 
                font-size: 20px; 
            }
            
            .song-panel { 
                top: 80px; 
                right: 10px; 
                left: 10px;
                min-width: auto;
            }
            
            .dialogue-bubble {
                max-width: 250px;
                font-size: 13px;
                padding: 12px 16px;
            }
            
            .mic-status {
                padding: 10px 15px;
            }
            
            .room-title {
                font-size: 14px;
            }
            
            .room-audience {
                font-size: 11px;
            }
        }
        
        /* è¶…å°å±å¹•é€‚é… */
        @media (max-width: 480px) {
            .interaction-panel {
                gap: 8px;
            }
            
            .interaction-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .btn-label {
                font-size: 10px;
                bottom: -20px;
            }
            
            .character-card {
                padding: 12px;
            }
            
            .character-name {
                font-size: 14px;
            }
            
            .character-desc {
                font-size: 11px;
            }
            
            .song-title {
                font-size: 14px;
            }
            
            .song-desc {
                font-size: 11px;
            }
            
            .special-moment {
                min-width: 280px;
                padding: 20px;
                top: 40%;
            }
            
            .moment-icon {
                font-size: 36px;
            }
            
            .moment-title {
                font-size: 20px;
            }
            
            .moment-desc {
                font-size: 14px;
            }
        }
        
        /* è¶…è¶…å°å±å¹•é€‚é… */
        @media (max-width: 360px) {
            .interaction-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .character-card {
                width: 95%;
                padding: 10px;
            }
            
            .dialogue-bubble {
                max-width: 220px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- ä¸»ç”»å¸ƒ -->
    <canvas id="canvas"></canvas>
    
    <!-- çƒŸèŠ±å®¹å™¨ -->
    <div class="fireworks-container" id="fireworksContainer"></div>
    
    <!-- éŸ³ä¹å…ç•Œé¢ -->
    <div class="voice-room">
        <div class="mic-status">
            <div class="mic-icon">ğŸ¤</div>
            <div class="room-info">
                <div class="room-title">é³Œæ‹œçš„è¯­éŸ³å…</div>
                <div class="room-audience">
                    <span>ğŸ‘¥ åœ¨çº¿å¬ä¼—:</span>
                    <span id="audienceCount">1</span>
                    <span>(â¤ï¸ å¤´å·ç²‰ä¸: é›·æ©)</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ­Œæ›²é¢æ¿ -->
    <div class="song-panel">
        <div class="current-song">
            <div class="song-icon">ğŸµ</div>
            <div class="song-info">
                <div class="song-title" id="currentSongTitle">æ­£åœ¨æ¼”å”±ï¼šã€Šå‹¾æŒ‡èµ·èª“ã€‹</div>
                <div class="song-desc" id="currentSongMood">ğŸ’• ç”œèœœæ—¶åˆ» | é›·æ©ä¸“å±ç‚¹æ­Œ</div>
            </div>
        </div>
        <div class="song-history">
            <div class="history-item">
                <span class="history-title">ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹</span>
                <span class="history-mood">âœ¨ çºªå¿µæ—¶åˆ»</span>
            </div>
            <div class="history-item">
                <span class="history-title">ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹</span>
                <span class="history-mood">ğŸ˜¢ åˆé‡å›å¿†</span>
            </div>
            <div class="history-item">
                <span class="history-title">ã€Šä»Šå¤œæœ‰é›¨ã€‹</span>
                <span class="history-mood">â˜”ï¸ ç›¸é‡</span>
            </div>
        </div>
    </div>
    
    <!-- è§’è‰²å¡ç‰‡ -->
    <div class="character-cards">
        <div class="character-card" id="aobai-card">
            <div class="card-header">
                <div class="character-avatar aobai-avatar">ğŸ¤</div>
                <div>
                    <div class="character-name" style="color: #ff6b6b;">é³Œæ‹œ</div>
                    <div class="character-desc">è¯­éŸ³å…æ­Œæ‰‹ | 23å² | ç™½ç¾Šåº§</div>
                </div>
            </div>
            <div class="mood-indicator">
                <div class="mood-icon" id="aobaiMoodIcon">ğŸ˜Š</div>
                <div class="mood-text" id="aobaiMoodText">å¿ƒæƒ…ä¸é”™</div>
            </div>
        </div>
        
        <div class="character-card" id="lein-card">
            <div class="card-header">
                <div class="character-avatar lein-avatar">ğŸŒŸ</div>
                <div>
                    <div class="character-name" style="color: #6bb3ff;">é›·æ©</div>
                    <div class="character-desc">å¤´å·ç²‰ä¸ | 25å² | å°„æ‰‹åº§</div>
                </div>
            </div>
            <div class="mood-indicator">
                <div class="mood-icon" id="leinMoodIcon">ğŸ˜</div>
                <div class="mood-text" id="leinMoodText">è¶…çº§å¼€å¿ƒ</div>
            </div>
        </div>
    </div>
    
    <!-- äº’åŠ¨æŒ‰é’® -->
    <div class="interaction-panel">
        <button class="interaction-btn btn-1" id="sendGiftBtn">
            ğŸ’
            <span class="btn-label">é€ç¤¼ç‰©</span>
        </button>
        <button class="interaction-btn btn-2" id="requestSongBtn">
            ğŸµ
            <span class="btn-label">ç‚¹æ­Œ</span>
        </button>
        <button class="interaction-btn btn-3" id="tellJokeBtn">
            ğŸ˜‚
            <span class="btn-label">é€—å¼€å¿ƒ</span>
        </button>
        <button class="interaction-btn btn-4" id="confessBtn">
            ğŸ’Œ
            <span class="btn-label">æ‚„æ‚„è¯</span>
        </button>
    </div>
    
    <!-- å¯¹è¯æ¡†å®¹å™¨ -->
    <div class="dialogue-container" id="dialogueContainer"></div>
    
    <!-- ç‰¹æ®Šæ—¶åˆ»å¼¹çª— -->
    <div class="special-moment" id="specialMoment">
        <div class="moment-icon" id="momentIcon">ğŸ†</div>
        <div class="moment-title" id="momentTitle">ç‰¹æ®Šæ—¶åˆ»</div>
        <div class="moment-desc" id="momentDesc"></div>
    </div>

 <script>
// ========== æ¸¸æˆæ•°æ® ==========
const GAME_STATE = {
    relationship: {
        level: 1,
        intimacy: 50,
        trust: 50,
        understanding: 50
    },
    aobai: {
        mood: 70,
        energy: 80,
        affection: 30,
        songs: [],
        favoriteSongs: ['å‹¾æŒ‡èµ·èª“', 'å¤å¤œæœ€åçš„çƒŸç«', 'æœ€åä¸€é¦–æƒ…æ­Œ']
    },
    lein: {
        mood: 90,
        energy: 100,
        affection: 80,
        secretFeelings: 50
    },
    currentSong: null,
    specialMoments: [],
    dayCount: 1,
    dialogueCount: 0
};

// ========== çœŸå®æ­Œå• ==========
const REAL_SONGS = [
    // åˆé‡ç³»åˆ—
    {
        id: 1,
        title: "æœ€åä¸€é¦–æƒ…æ­Œ",
        artist: "è‹ç›",
        mood: "melancholy",
        lyrics: "è¿™æ˜¯æœ€åä¸€é¦–æƒ…æ­Œï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€é¦–æƒ…æ­Œ",
        unlockDay: 1,
        special: "firstMeeting"
    },
    {
        id: 2,
        title: "ä»Šå¤œæœ‰é›¨",
        artist: "é˜Ÿé•¿",
        mood: "rainy",
        lyrics: "ä»Šå¤œæœ‰é›¨ï¼Œæˆ‘åœ¨é›¨ä¸­ç­‰ä½ ",
        unlockDay: 1,
        special: "rainyNight"
    },
    // ç”œèœœæ—¶åˆ»
    {
        id: 3,
        title: "å‹¾æŒ‡èµ·èª“",
        artist: "æ´›å¤©ä¾/è¨€å’Œ",
        mood: "sweet",
        lyrics: "æ‹‰é’©ä¸ŠåŠä¸€ç™¾å¹´ä¸è®¸å˜ï¼Œéª—äººçš„æ˜¯å°ç‹—",
        unlockDay: 3,
        special: "promise"
    },
    {
        id: 4,
        title: "å¤å¤œæœ€åçš„çƒŸç«",
        artist: "å¼ é½å±±",
        mood: "romantic",
        lyrics: "ä½ åƒå¤å¤œæœ€åçš„çƒŸç«ï¼Œç…§äº®æˆ‘æ•´ä¸ªæ˜Ÿç©º",
        unlockDay: 5,
        special: "fireworks"
    },
    // æ·±æƒ…ç³»åˆ—
    {
        id: 5,
        title: "æ°´æ˜Ÿè®°",
        artist: "éƒ­é¡¶",
        mood: "deep",
        lyrics: "è¿˜è¦å¤šè¿œæ‰èƒ½è¿›å…¥ä½ çš„å¿ƒï¼Œè¿˜è¦å¤šä¹…æ‰èƒ½å’Œä½ æ¥è¿‘",
        unlockDay: 7
    },
    {
        id: 6,
        title: "å½¢å®¹",
        artist: "æ²ˆä»¥è¯š",
        mood: "gentle",
        lyrics: "å°±åƒæ˜¯é‚£ç°è‰²å¤©ç©ºä¸­çš„å°é›¨ï¼Œä¸‹ä¸‹åœåœä¸åŠ¨å£°è‰²æ·‹æ¹¿åœŸåœ°",
        unlockDay: 10
    },
    {
        id: 7,
        title: "ä¸‹é›¨å¤©",
        artist: "å—æ‹³å¦ˆå¦ˆ",
        mood: "cozy",
        lyrics: "ä¸‹é›¨å¤©äº†æ€ä¹ˆåŠï¼Œæˆ‘å¥½æƒ³ä½ ",
        unlockDay: 12
    },
    {
        id: 8,
        title: "æ’’é‡",
        artist: "å‡¯ç‘Ÿå–µ",
        mood: "passionate",
        lyrics: "æˆ‘æƒ³æŠ¬å¤´æš–é˜³æ˜¥è‰ï¼Œä½ ç»™æˆ‘ç®€å•æ‹¥æŠ±",
        unlockDay: 15
    }
];

// ========== äººç‰©å¯¹è¯åº“ ==========
const DIALOGUES = {
    // é³Œæ‹œçš„å¯¹è¯
    aobai: {
        happy: [
            "ä»Šå¤©å”±æ­ŒçŠ¶æ€è¶…å¥½ï¼è°¢è°¢é›·æ©ä¸€ç›´åœ¨ï½",
            "çœ‹åˆ°ä½ é€çš„ç¤¼ç‰©äº†ï¼Œå¥½å¯çˆ±ï¼ğŸ˜Š",
            "è¿™é¦–ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹æ˜¯æˆ‘ä»¬ä¸€èµ·çœ‹çš„ç¬¬ä¸€ä¸ªå¤å¤©å‘¢",
            "è™½ç„¶æœ‰æ—¶å€™ä½ ç¬¨ç¬¨çš„ï¼Œä½†çœŸçš„å¾ˆè´´å¿ƒ",
            "æœ‰ä½ è¿™ä¸ªæœ‹å‹çœŸå¥½ï¼ŒçœŸçš„",
            "é›·æ©ä½ ä»Šå¤©å¥½æ´»è·ƒå‘€ï¼",
            "å”±å®Œè¿™é¦–ã€Šå‹¾æŒ‡èµ·èª“ã€‹æ„Ÿè§‰æ•´ä¸ªäººéƒ½å¼€å¿ƒäº†",
            "ä½ çš„æ”¯æŒæ˜¯æˆ‘å”±æ­Œçš„æœ€å¤§åŠ¨åŠ›ï¼",
            "æ¯æ¬¡çœ‹åˆ°ä½ çš„ç•™è¨€éƒ½å¥½æ¸©æš–",
            "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå¿ƒæƒ…ä¹Ÿç‰¹åˆ«å¥½ï¼",
            "ä½ çŸ¥é“å—ï¼Ÿæ¯æ¬¡çœ‹åˆ°ä½ åœ¨çº¿ï¼Œæˆ‘å”±æ­Œéƒ½ç‰¹åˆ«æœ‰åŠ²ï¼",
            "ä»Šå¤©çš„å¼¹å¹•éƒ½æ˜¯ä½ åˆ·çš„ç¤¼ç‰©ï¼Œå¤ªæ„ŸåŠ¨äº†ï½",
            "é›·æ©ä½ æ˜¯æˆ‘è§è¿‡æœ€å¿ å®çš„å¬ä¼—ï¼",
            "å”±äº†è¿™ä¹ˆä¹…ï¼Œåªæœ‰ä½ ä¸€ç›´éƒ½åœ¨",
            "ä½ çš„æ¯ä¸€æ¡ç•™è¨€æˆ‘éƒ½æœ‰è®¤çœŸçœ‹å“¦ï¼"
        ],
        touched: [
            "é›·æ©...è°¢è°¢ä½ é™ªæˆ‘èµ°è¿‡é‚£æ®µæœ€éš¾çš„æ—¥å­",
            "åªæœ‰ä½ è®°å¾—æˆ‘æ¯ä¸€é¦–æ­Œçš„æ„ä¹‰",
            "é›¨å¤œé‚£é¦–ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹ï¼Œä½ æ˜¯ç¬¬ä¸€ä¸ªç‚¹æˆ‘æ­Œçš„äºº",
            "æœ‰æ—¶å€™è§‰å¾—ï¼Œæœ‰ä½ è¿™æ ·çš„æœ‹å‹ï¼Œå”±æ­Œéƒ½æ›´æœ‰æ„ä¹‰äº†",
            "è¿™é¦–ã€Šå‹¾æŒ‡èµ·èª“ã€‹ï¼Œæ˜¯å”±ç»™ä½ çš„æ‰¿è¯º",
            "ä½ æ˜¯æˆ‘è§è¿‡æœ€çœŸè¯šçš„ç²‰ä¸...",
            "æœ‰æ—¶å€™çœŸçš„ä¸çŸ¥é“è¯¥æ€ä¹ˆæ„Ÿè°¢ä½ ",
            "æœ‰ä½ åœ¨ï¼Œå”±æ­Œéƒ½ä¸å­¤å•äº†",
            "ä½ çš„æ¯ä¸€æ¡ç•™è¨€æˆ‘éƒ½è®¤çœŸçœ‹äº†",
            "è°¢è°¢ä½ ä¸€ç›´ç›¸ä¿¡æˆ‘...",
            "è®°å¾—æˆ‘ç¬¬ä¸€æ¬¡å¼€è¯­éŸ³å…çš„æ—¶å€™ï¼Œåªæœ‰ä½ ä¸€ä¸ªäºº",
            "é‚£æ—¶å€™æˆ‘å”±å¾—ä¸å¥½ï¼Œä½†ä½ ä¸€ç›´é¼“åŠ±æˆ‘",
            "æ²¡æœ‰ä½ çš„æ”¯æŒï¼Œæˆ‘å¯èƒ½æ—©å°±æ”¾å¼ƒäº†",
            "ä½ é€çš„æ¯ä¸€ä¸ªç¤¼ç‰©ï¼Œæˆ‘éƒ½å¥½å¥½ä¿å­˜ç€",
            "é›·æ©ï¼Œä½ å¯¹æˆ‘æ¥è¯´çœŸçš„å¾ˆé‡è¦"
        ],
        confused: [
            "é›·æ©ä»Šå¤©æ€ä¹ˆæ€ªæ€ªçš„...",
            "ä½ æœ€è¿‘æ€»æ˜¯æ¬²è¨€åˆæ­¢çš„æ ·å­",
            "æˆ‘ä»¬åªæ˜¯å¥½æœ‹å‹ï¼Œå¯¹å§ï¼Ÿ",
            "æœ‰æ—¶å€™ä½ çš„å…³å¿ƒ...è®©æˆ‘æœ‰ç‚¹ä¸çŸ¥æ‰€æª",
            "ä¸è¦å¯¹æˆ‘å¤ªå¥½ï¼Œæˆ‘ä¼šå®³æ€•å¤±å»",
            "ä½ åˆ°åº•æƒ³è¯´ä»€ä¹ˆå‘¢ï¼Ÿ",
            "æˆ‘æ„Ÿè§‰ä½ åœ¨éšç’ä»€ä¹ˆ...",
            "æˆ‘ä»¬è¿™æ ·çš„å…³ç³»å°±æŒºå¥½çš„...",
            "ä½ æœ€è¿‘çœ‹æˆ‘çš„çœ¼ç¥æœ‰ç‚¹ä¸ä¸€æ ·",
            "ä½ æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆè¯è¦å¯¹æˆ‘è¯´ï¼Ÿ",
            "ä¸ºä»€ä¹ˆä½ æ€»é€æˆ‘è¿™ä¹ˆè´µé‡çš„ç¤¼ç‰©ï¼Ÿ",
            "æœ‹å‹ä¹‹é—´ä¸ç”¨è¿™æ ·çš„...",
            "ä½ è¿™æ ·æˆ‘ä¼šä¸å¥½æ„æ€çš„",
            "æˆ‘ä»¬ä¿æŒç°åœ¨çš„å…³ç³»å°±å¥½ï¼Œå¥½å—ï¼Ÿ",
            "ä½ ...æ˜¯ä¸æ˜¯å–œæ¬¢æˆ‘ï¼Ÿ"
        ]
    },
    
    // é›·æ©çš„å¯¹è¯
    lein: {
        adoring: [
            "é³Œæ‹œçš„å£°éŸ³æ˜¯ä¸–ç•Œä¸Šæœ€ç¾çš„ï¼ğŸ˜",
            "ä»Šå¤©ä¹Ÿä¸ºäº†å¬ä½ å”±æ­Œæ¥çš„ï½",
            "ä½ å”±ã€Šå‹¾æŒ‡èµ·èª“ã€‹çš„æ—¶å€™ï¼Œå¿ƒè·³éƒ½æ¼äº†ä¸€æ‹",
            "æƒ³ä¸ºä½ æ‰¿åŒ…æ•´ä¸ªè¯­éŸ³å…çš„ç¤¼ç‰©æ¦œï¼",
            "ä½ çš„æ¯é¦–æ­Œæˆ‘éƒ½ä¼šå¬ä¸€åƒé",
            "ä»Šå¤©ä¹Ÿè¦ä¸ºé³Œæ‹œæ‰“callï¼",
            "ä½ çš„æ­Œå£°å°±æ˜¯æˆ‘çš„èƒ½é‡ï¼",
            "å¬ç€ä½ å”±æ­Œï¼Œä»€ä¹ˆçƒ¦æ¼éƒ½æ²¡äº†",
            "ä½ å”±ä»€ä¹ˆæ­Œæˆ‘éƒ½å–œæ¬¢ï¼",
            "æ°¸è¿œæ”¯æŒé³Œæ‹œï¼",
            "é³Œæ‹œä»Šå¤©ä¹Ÿå¥½å¯çˆ±ï¼",
            "ä½ ä¸€ç¬‘ï¼Œæˆ‘çš„ä¸–ç•Œéƒ½äº®äº†",
            "æ¯å¤©æœ€æœŸå¾…çš„å°±æ˜¯å¬ä½ å”±æ­Œ",
            "ä½ çš„å£°éŸ³æœ‰æ²»æ„ˆé­”æ³•ï¼",
            "æˆ‘ä¼šä¸€ç›´ä¸€ç›´å¬ä½ å”±æ­Œçš„ï¼"
        ],
        caring: [
            "ç´¯äº†å—ï¼Ÿè¦æ³¨æ„ä¼‘æ¯å“¦",
            "ä¸ç®¡å‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘éƒ½ä¼šæ”¯æŒä½ ",
            "ä½ çš„æ¢¦æƒ³å°±æ˜¯æˆ‘çš„æ¢¦æƒ³",
            "ä»Šå¤©ä¸‹é›¨äº†ï¼Œè®°å¾—å¸¦ä¼",
            "è¦æŒ‰æ—¶åƒé¥­ï¼Œä¸è¦æ€»ç†¬å¤œç»ƒæ­Œ",
            "å—“å­ä¸èˆ’æœå°±å°‘å”±ç‚¹æ­Œ",
            "æœ‰ä»€ä¹ˆçƒ¦æ¼å¯ä»¥è·Ÿæˆ‘è¯´",
            "æˆ‘ä¼šä¸€ç›´åœ¨è¿™é‡Œç­‰ä½ ",
            "è®°å¾—å¤šå–æ°´ä¿æŠ¤å—“å­",
            "åˆ«å¤ªæ‹¼äº†ï¼Œèº«ä½“æœ€é‡è¦",
            "ä»Šå¤©å†·ï¼Œå¤šç©¿ç‚¹è¡£æœ",
            "æˆ‘ç»™ä½ ç‚¹äº†çƒ­å¥¶èŒ¶ï¼Œè®°å¾—å–",
            "ä¸å¼€å¿ƒçš„æ—¶å€™è¦å‘Šè¯‰æˆ‘",
            "ä½ å€¼å¾—è¢«ä¸–ç•Œæ¸©æŸ”å¯¹å¾…",
            "æˆ‘ä¼šæ°¸è¿œç«™åœ¨ä½ è¿™è¾¹"
        ],
        playful: [
            "é³Œæ‹œï½ç¬‘ä¸€ä¸ªå˜›ï¼ğŸ˜œ",
            "çŒœçŒœæˆ‘ä»Šå¤©ç»™ä½ å‡†å¤‡äº†ä»€ä¹ˆæƒŠå–œï¼Ÿ",
            "è¦ä¸è¦å¬ä¸ªç¬‘è¯ï¼Ÿä¿è¯è®©ä½ ç¬‘å‡ºå£°ï¼",
            "ä»Šå¤©ä¹Ÿæ˜¯è¶…çº§å–œæ¬¢é³Œæ‹œçš„ä¸€å¤©ï¼",
            "ä½ ç”Ÿæ°”çš„æ ·å­ä¹Ÿå¥½å¯çˆ±å•Šï½",
            "æˆ‘ä»¬æ¥ç©ä¸ªæ¸¸æˆå§ï¼",
            "ä»Šå¤©æœ‰æ²¡æœ‰æƒ³æˆ‘å‘€ï¼Ÿ",
            "æˆ‘æœ‰ä¸ªç§˜å¯†è¦å‘Šè¯‰ä½ ï½",
            "ä½ è§‰å¾—æˆ‘ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ",
            "æˆ‘ä»¬æ¥åˆå”±ä¸€é¦–æ­Œå§ï¼",
            "é³Œæ‹œä»Šå¤©å¥½æ¼‚äº®ï¼",
            "æˆ‘æ˜¯ä¸æ˜¯ä½ æœ€å¿ å®çš„ç²‰ä¸ï¼Ÿ",
            "æˆ‘ä»¬æ¥æ¯”æ¯”è°ç¬‘å¾—æ›´å¼€å¿ƒï¼",
            "ä»Šå¤©è¦å”±å‡ é¦–æ­Œå‘€ï¼Ÿ",
            "æˆ‘ç»™ä½ è®²ä¸ªç¡å‰æ•…äº‹å§ï½"
        ],
        nervous: [
            "é‚£ä¸ª...é³Œæ‹œï¼Œæˆ‘æœ‰è¯æƒ³å¯¹ä½ è¯´...",
            "ä»Šå¤©æ˜¯ä¸æ˜¯åˆè¯´é”™è¯æƒ¹ä½ ç”Ÿæ°”äº†",
            "åªæ˜¯æœ‹å‹...å—ï¼Ÿå¯æ˜¯æˆ‘æƒ³...",
            "å¥½æƒ³å‘Šè¯‰ä½ æˆ‘çš„å¿ƒæ„ï¼Œä½†åˆæ€•å¤±å»ä½ ",
            "çœ‹ç€ä½ ç¬‘ï¼Œæˆ‘å°±è§‰å¾—ä¸–ç•Œéƒ½äº®äº†",
            "æˆ‘æ˜¯ä¸æ˜¯å¤ªé»ç€ä½ äº†ï¼Ÿ",
            "ä½ å¯¹æˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ„Ÿè§‰å‘¢ï¼Ÿ",
            "å¥½æƒ³ç¦»ä½ æ›´è¿‘ä¸€ç‚¹...",
            "ä½ æ˜¯ä¸æ˜¯åœ¨èº²ç€æˆ‘ï¼Ÿ",
            "æˆ‘çš„å¿ƒæ„ï¼Œä½ èƒ½æ„Ÿè§‰åˆ°å—ï¼Ÿ",
            "æœ‰æ—¶å€™æˆ‘çœŸçš„å¥½çŸ›ç›¾...",
            "æˆ‘è¯¥ä¸è¯¥å‘Šè¯‰ä½ æˆ‘çš„çœŸå®æƒ³æ³•ï¼Ÿ",
            "ä½ å¯¹æˆ‘...æœ‰æ„Ÿè§‰å—ï¼Ÿ",
            "æˆ‘çŸ¥é“æˆ‘åªæ˜¯ä½ çš„ç²‰ä¸...",
            "ä½†è¿˜æ˜¯å¿ä¸ä½æƒ³é è¿‘ä½ "
        ]
    }
};

// ========== ç¬‘è¯åº“ ==========
const JOKES = [
    "ä¸ºä»€ä¹ˆæ­Œæ‰‹è¿‡é©¬è·¯è¦æˆ´è€³æœºï¼Ÿå› ä¸ºè¦å¬çº¢ç»¿ç¯çš„èŠ‚å¥ï¼",
    "é³Œæ‹œä½ çŸ¥é“ä¸ºä»€ä¹ˆéŸ³ä¹å…çš„WiFiä¿¡å·æœ€å¥½å—ï¼Ÿå› ä¸ºéŸ³ç¬¦ä¼šä¼ æ’­ä¿¡å·ï¼",
    "å¦‚æœæˆ‘æ˜¯éŸ³ç¬¦ï¼Œä½ å°±æ˜¯æˆ‘çš„è°ƒå·ï¼Œè®©æˆ‘æ•´ä¸ªäººéƒ½èµ°è°ƒäº†ï½",
    "é›·æ©ï¼šæˆ‘æƒ³ç‚¹ä¸€é¦–æ­Œ é³Œæ‹œï¼šä»€ä¹ˆæ­Œï¼Ÿ é›·æ©ï¼šæˆ‘ä»¬çš„ä¸»é¢˜æ›²ã€Šå¥½æœ‹å‹ã€‹",
    "ä¸ºä»€ä¹ˆæˆ‘æ€»æ¥å¬ä½ å”±æ­Œï¼Ÿå› ä¸ºä½ çš„å£°éŸ³æ¯”å’–å•¡è¿˜æç¥ï¼",
    "é³Œæ‹œï¼šä»Šå¤©å”±ä»€ä¹ˆå¥½å‘¢ï¼Ÿ é›·æ©ï¼šå”±ã€Šä¸ºä»€ä¹ˆé›·æ©è¿™ä¹ˆå¯çˆ±ã€‹",
    "å¦‚æœå”±æ­Œèƒ½å‘ç”µï¼Œé³Œæ‹œä½ ä¸€ä¸ªäººå°±èƒ½ç‚¹äº®æ•´ä¸ªåŸå¸‚ï¼",
    "ä½ è§‰å¾—æˆ‘åƒä»€ä¹ˆæ­Œï¼Ÿæˆ‘è§‰å¾—æˆ‘åƒã€Šæœ‰ç‚¹ç”œã€‹ï½",
    "ä½ çŸ¥é“ä»€ä¹ˆæ­Œæœ€é€‚åˆæˆ‘å—ï¼Ÿã€Šç¦»ä¸å¼€ä½ ã€‹ï¼",
    "ä½ çŒœæˆ‘ç°åœ¨åœ¨æƒ³ä»€ä¹ˆï¼Ÿåœ¨æƒ³ä½ å‘€ï¼",
    "é³Œæ‹œæ˜¯ä¸–ç•Œä¸Šæœ€ç”œçš„æ­Œæ‰‹ï¼æ¯”ç³–è¿˜ç”œï¼",
    "æˆ‘ä¸­äº†ä¸€ç§æ¯’ï¼Œè§£è¯æ˜¯ä½ çš„æ­Œå£°",
    "ä½ çš„å£°éŸ³æ˜¯é­”æ³•ï¼Œæˆ‘è¢«æ–½äº†é­”æ³•",
    "æˆ‘å¾—äº†ç›¸æ€ç—…ï¼Œåªæœ‰ä½ èƒ½æ²»",
    "ä½ ä¸€ç¬‘ï¼Œæ˜¥å¤©å°±æ¥äº†"
];

// ========== ç²’å­ç³»ç»Ÿ ==========
let particles = [];
let canvas, ctx;

class Particle {
    constructor(x, y, type, color) {
        this.x = x;
        this.y = y;
        this.type = type; // 'heart', 'music', 'sparkle'
        this.color = color;
        this.size = Math.random() * 8 + 4;
        this.speedY = Math.random() * 3 + 1;
        this.speedX = (Math.random() - 0.5) * 2;
        this.life = 100;
        this.maxLife = 100;
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.1;
    }
    
    update() {
        this.y -= this.speedY;
        this.x += this.speedX;
        this.life--;
        this.rotation += this.rotationSpeed;
        
        // é‡åŠ›æ•ˆæœ
        this.speedY *= 0.98;
        
        return this.life > 0;
    }
    
    draw() {
        ctx.save();
        ctx.globalAlpha = this.life / this.maxLife;
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        
        switch(this.type) {
            case 'heart':
                ctx.fillStyle = this.color;
                ctx.beginPath();
                for(let i=0; i<Math.PI*2; i+=0.1) {
                    const px = 16 * Math.pow(Math.sin(i), 3);
                    const py = -(13 * Math.cos(i) - 5*Math.cos(2*i) - 2*Math.cos(3*i) - Math.cos(4*i));
                    ctx.lineTo(px * this.size/30, py * this.size/30);
                }
                ctx.fill();
                break;
                
            case 'music':
                ctx.fillStyle = this.color;
                ctx.font = `${this.size * 2}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('â™ª', 0, 0);
                break;
                
            case 'sparkle':
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fill();
                break;
        }
        
        ctx.restore();
    }
}

// ========== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ==========
let dialogueQueue = [];
let isShowingDialogue = false;

function showDialogue(character, text, duration = 2500) {
    GAME_STATE.dialogueCount++;
    
    // åˆ›å»ºæ–°çš„å¯¹è¯æ¡†å…ƒç´ 
    const container = document.getElementById('dialogueContainer');
    const bubble = document.createElement('div');
    bubble.className = 'dialogue-bubble';
    bubble.id = `dialogue-${Date.now()}`;
    
    // è®¾ç½®ä½ç½®ï¼ˆäº¤æ›¿æ˜¾ç¤ºåœ¨å·¦å³ï¼‰
    const isLeft = character === 'aobai';
    const topPosition = 120 + (dialogueQueue.length % 4) * 100;
    
    if (isLeft) {
        bubble.style.left = '20px';
        bubble.style.right = 'auto';
        bubble.style.transformOrigin = '20px bottom';
    } else {
        bubble.style.left = 'auto';
        bubble.style.right = '20px';
        bubble.style.transformOrigin = 'calc(100% - 20px) bottom';
    }
    bubble.style.top = `${topPosition}px`;
    
    // è®¾ç½®ç®­å¤´æ–¹å‘
    if (isLeft) {
        bubble.style.setProperty('--arrow-left', '30px');
        bubble.style.setProperty('--arrow-right', 'auto');
    } else {
        bubble.style.setProperty('--arrow-left', 'auto');
        bubble.style.setProperty('--arrow-right', '30px');
    }
    
    // å†…å®¹
    bubble.innerHTML = `
        <div class="dialogue-owner">
            <span style="color: ${isLeft ? '#ff6b6b' : '#6bb3ff'}">
                ${isLeft ? 'ğŸ¤ é³Œæ‹œ' : 'ğŸŒŸ é›·æ©'}
            </span>
            <small style="opacity:0.6; margin-left:auto;">${GAME_STATE.dialogueCount}</small>
        </div>
        <div class="dialogue-content">${text}</div>
    `;
    
    container.appendChild(bubble);
    
    // æ˜¾ç¤ºåŠ¨ç”»
    setTimeout(() => {
        bubble.classList.add('show');
    }, 10);
    
    // è‡ªåŠ¨éšè—
    setTimeout(() => {
        bubble.classList.remove('show');
        setTimeout(() => {
            if (bubble.parentNode) {
                bubble.parentNode.removeChild(bubble);
            }
        }, 300);
    }, duration);
    
    // åˆ›å»ºç²’å­æ•ˆæœ
    createParticleEffect('sparkle', 5, 
        isLeft ? 50 : window.innerWidth - 50, 
        topPosition + 30
    );
    
    // æ—¥å¿—
    console.log(`ğŸ’¬ æ˜¾ç¤ºå¯¹è¯ [${character}]: ${text}`);
}

function updateMood() {
    const aobaiMoods = ['ğŸ˜ ', 'ğŸ˜', 'ğŸ˜Š', 'ğŸ˜'];
    const leinMoods = ['ğŸ˜¢', 'ğŸ˜', 'ğŸ˜Š', 'ğŸ˜'];
    
    const aobaiMood = Math.floor(GAME_STATE.aobai.mood / 25);
    const leinMood = Math.floor(GAME_STATE.lein.mood / 25);
    
    document.getElementById('aobaiMoodIcon').textContent = aobaiMoods[Math.min(aobaiMood, 3)];
    document.getElementById('leinMoodIcon').textContent = leinMoods[Math.min(leinMood, 3)];
    
    // æ›´æ–°å¿ƒæƒ…æ–‡æœ¬
    const aobaiMoodTexts = ['å¿ƒæƒ…å¾ˆå·®', 'æœ‰ç‚¹ä½è½', 'å¿ƒæƒ…ä¸é”™', 'è¶…çº§å¼€å¿ƒ'];
    const leinMoodTexts = ['å¾ˆéš¾è¿‡', 'æƒ…ç»ªä¸€èˆ¬', 'å¿ƒæƒ…æ„‰æ‚¦', 'è¶…å¹¸ç¦'];
    
    document.getElementById('aobaiMoodText').textContent = aobaiMoodTexts[Math.min(aobaiMood, 3)];
    document.getElementById('leinMoodText').textContent = leinMoodTexts[Math.min(leinMood, 3)];
    
    // æ›´æ–°è§’è‰²å¡ç‰‡è¾¹æ¡†äº®åº¦
    const aobaiCard = document.getElementById('aobai-card');
    const leinCard = document.getElementById('lein-card');
    
    const aobaiBrightness = 0.3 + (GAME_STATE.aobai.mood / 100) * 0.7;
    const leinBrightness = 0.3 + (GAME_STATE.lein.mood / 100) * 0.7;
    
    aobaiCard.style.borderColor = `rgba(255, 107, 107, ${aobaiBrightness})`;
    leinCard.style.borderColor = `rgba(107, 179, 255, ${leinBrightness})`;
}

function createParticleEffect(type, count, x, y) {
    const colors = {
        'heart': ['#ff6b6b', '#ff8e53', '#ffd166'],
        'music': ['#6bb3ff', '#53c5ff', '#a663cc'],
        'sparkle': ['#ffffff', '#ffd166', '#ff8e53']
    };
    
    for (let i = 0; i < count; i++) {
        const color = colors[type][Math.floor(Math.random() * colors[type].length)];
        particles.push(new Particle(x, y, type, color));
    }
}

function showSpecialMoment(title, description, icon = 'ğŸ†') {
    const momentElement = document.getElementById('specialMoment');
    const momentIcon = document.getElementById('momentIcon');
    const momentTitle = document.getElementById('momentTitle');
    const momentDesc = document.getElementById('momentDesc');
    
    momentIcon.textContent = icon;
    momentTitle.textContent = title;
    momentDesc.textContent = description;
    
    momentElement.classList.add('show');
    
    // è®°å½•ç‰¹æ®Šæ—¶åˆ»
    GAME_STATE.specialMoments.push({
        title,
        description,
        day: GAME_STATE.dayCount,
        timestamp: Date.now()
    });
    
    // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
    createFireworks();
    
    // è‡ªåŠ¨éšè—
    setTimeout(() => {
        momentElement.classList.remove('show');
    }, 4000);
}

function createFireworks() {
    const container = document.getElementById('fireworksContainer');
    
    for (let i = 0; i < 20; i++) {
        const firework = document.createElement('div');
        firework.style.position = 'absolute';
        firework.style.left = `${Math.random() * 100}%`;
        firework.style.top = `${Math.random() * 100}%`;
        firework.style.fontSize = `${Math.random() * 30 + 20}px`;
        firework.style.opacity = '0';
        
        const emojis = ['ğŸ†', 'âœ¨', 'ğŸ‡', 'ğŸ’¥', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ†', 'âœ¨'];
        firework.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        
        container.appendChild(firework);
        
        // åŠ¨ç”»
        const duration = Math.random() * 1000 + 1000;
        const delay = Math.random() * 500;
        
        setTimeout(() => {
            firework.style.transition = `all ${duration}ms ease-out`;
            firework.style.opacity = '1';
            firework.style.transform = `translateY(-100px) rotate(${Math.random() * 360}deg)`;
            
            setTimeout(() => {
                firework.style.opacity = '0';
                setTimeout(() => {
                    if (firework.parentNode) {
                        firework.parentNode.removeChild(firework);
                    }
                }, duration);
            }, duration);
        }, delay);
    }
}

function sendGift() {
    const gifts = [
        { name: "è™šæ‹Ÿç«ç‘°", value: 10, emoji: "ğŸŒ¹" },
        { name: "å°æ˜Ÿæ˜Ÿ", value: 20, emoji: "â­" },
        { name: "éº¦å…‹é£", value: 30, emoji: "ğŸ¤" },
        { name: "çˆ±å¿ƒè›‹ç³•", value: 40, emoji: "ğŸ°" },
        { name: "æ˜Ÿç©ºçƒŸèŠ±", value: 50, emoji: "ğŸ†" }
    ];
    
    const gift = gifts[Math.floor(Math.random() * gifts.length)];
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    GAME_STATE.aobai.mood = Math.min(100, GAME_STATE.aobai.mood + gift.value / 2);
    GAME_STATE.lein.mood = Math.min(100, GAME_STATE.lein.mood + 5);
    GAME_STATE.relationship.intimacy += 3;
    
    // æ˜¾ç¤ºå¯¹è¯
    showDialogue('lein', `ç»™é³Œæ‹œé€äº†${gift.emoji}${gift.name}ï¼å¸Œæœ›ä½ ä¼šå–œæ¬¢ï½`);
    
    setTimeout(() => {
        const responses = [
            `è°¢è°¢é›·æ©çš„${gift.emoji}${gift.name}ï¼å¥½æ¼‚äº®ï½`,
            `å“‡ï¼${gift.emoji}${gift.name}ï¼é›·æ©ä½ å¤ªç ´è´¹äº†ï¼`,
            `è¿™ä¸ª${gift.name}å¥½å¯çˆ±ï¼è°¢è°¢é›·æ©ï½`
        ];
        showDialogue('aobai', responses[Math.floor(Math.random() * responses.length)]);
    }, 800);
    
    // æ›´æ–°ç•Œé¢
    updateMood();
    createParticleEffect('heart', 15, window.innerWidth / 2, window.innerHeight - 100);
}

function requestSong() {
    // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç‚¹æ’­çš„æ­Œæ›²
    const availableSongs = REAL_SONGS.filter(song => 
        song.unlockDay <= GAME_STATE.dayCount && 
        !GAME_STATE.aobai.songs.includes(song.id)
    );
    
    if (availableSongs.length === 0) {
        showDialogue('lein', "ä»Šå¤©æƒ³å¬çš„æ­Œéƒ½å·²ç»å”±è¿‡äº†å‘¢ï½æ˜å¤©å†æ¥ç‚¹æ­Œå§ï¼");
        return;
    }
    
    const song = availableSongs[Math.floor(Math.random() * availableSongs.length)];
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    GAME_STATE.aobai.songs.push(song.id);
    GAME_STATE.currentSong = song;
    GAME_STATE.aobai.mood = Math.min(100, GAME_STATE.aobai.mood + 10);
    GAME_STATE.lein.mood = Math.min(100, GAME_STATE.lein.mood + 15);
    GAME_STATE.relationship.understanding += 5;
    
    // æ›´æ–°æ­Œæ›²é¢æ¿
    document.getElementById('currentSongTitle').textContent = `æ­£åœ¨æ¼”å”±ï¼šã€Š${song.title}ã€‹`;
    
    const moodTexts = {
        'melancholy': 'ğŸ˜¢ æ·±æƒ…æ—¶åˆ»',
        'rainy': 'â˜”ï¸ é›¨å¤©å›å¿†',
        'sweet': 'ğŸ’• ç”œèœœæ—¶åˆ»',
        'romantic': 'âœ¨ æµªæ¼«ç¬é—´',
        'deep': 'ğŸ’– æ·±æƒ…æ¼”ç»',
        'gentle': 'ğŸŒ¸ æ¸©æŸ”æ—¶å…‰',
        'cozy': 'ğŸ  æ¸©é¦¨æ—¶åˆ»',
        'passionate': 'ğŸ”¥ çƒ­æƒ…æ´‹æº¢'
    };
    
    document.getElementById('currentSongMood').textContent = 
        `${moodTexts[song.mood] || 'ğŸµ éŸ³ä¹æ—¶åˆ»'} | é›·æ©ç‚¹æ­Œ`;
    
    // æ˜¾ç¤ºå¯¹è¯
    showDialogue('lein', `æˆ‘æƒ³ç‚¹ä¸€é¦–ã€Š${song.title}ã€‹ï¼è¿™é¦–æ­Œçš„æ­Œè¯"${song.lyrics}"ç‰¹åˆ«æœ‰æ„ä¹‰ï½`);
    
    setTimeout(() => {
        const responses = [
            `ã€Š${song.title}ã€‹å—ï¼Ÿå¥½çš„ï¼Œè¿™é¦–æ­Œæˆ‘ä¹Ÿå¾ˆå–œæ¬¢ï¼`,
            `é›·æ©ç‚¹çš„ã€Š${song.title}ã€‹å•Š...è¿™é¦–æ­Œè®©æˆ‘æƒ³èµ·æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç›¸é‡çš„æ—¶å€™`,
            `è¿™é¦–ã€Š${song.title}ã€‹...æ˜¯ç‰¹æ„ä¸ºæˆ‘ç‚¹çš„å—ï¼Ÿè°¢è°¢ä½ ï½`
        ];
        showDialogue('aobai', responses[Math.floor(Math.random() * responses.length)]);
    }, 1000);
    
    // å¦‚æœæ˜¯ç‰¹æ®Šæ­Œæ›²ï¼Œè§¦å‘ç‰¹æ®Šæ—¶åˆ»
    if (song.special) {
        setTimeout(() => {
            if (song.special === 'firstMeeting') {
                showSpecialMoment("åˆé‡å›å¿†", "é›¨å¤œé‡Œï¼Œç¬¬ä¸€é¦–æ­Œï¼Œç¬¬ä¸€æ¬¡å¿ƒè·³...", "ğŸŒ§ï¸");
            } else if (song.special === 'fireworks') {
                showSpecialMoment("å¤å¤œçƒŸç«", "ä½ è¯´æˆ‘çš„å£°éŸ³åƒå¤å¤œæœ€åçš„çƒŸç«ï¼Œç…§äº®äº†ä½ çš„æ˜Ÿç©º", "ğŸ†");
            } else if (song.special === 'promise') {
                showSpecialMoment("å‹¾æŒ‡èµ·èª“", "æ‹‰é’©ä¸ŠåŠä¸€ç™¾å¹´ä¸è®¸å˜ï¼Œéª—äººçš„æ˜¯å°ç‹—", "ğŸ¤™");
            }
        }, 2000);
    }
    
    // æ›´æ–°ç•Œé¢
    updateMood();
    createParticleEffect('music', 20, window.innerWidth / 2, window.innerHeight / 2);
}

function tellJoke() {
    const joke = JOKES[Math.floor(Math.random() * JOKES.length)];
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    const moodIncrease = Math.floor(Math.random() * 15) + 10;
    GAME_STATE.aobai.mood = Math.min(100, GAME_STATE.aobai.mood + moodIncrease);
    GAME_STATE.lein.mood = Math.min(100, GAME_STATE.lein.mood + 5);
    GAME_STATE.relationship.intimacy += 2;
    
    // æ˜¾ç¤ºå¯¹è¯
    showDialogue('lein', joke);
    
    setTimeout(() => {
        const responses = [
            "å™—...é›·æ©ä½ çœŸæ˜¯çš„ï¼ğŸ˜‚",
            "å“ˆå“ˆå“ˆï¼Œè¿™ä¸ªç¬‘è¯å¥½å¥½ç¬‘ï¼",
            "é›·æ©ä½ ä»å“ªå­¦çš„è¿™äº›å•Šï½",
            "çœŸå—ä¸äº†ä½ ï¼Œä¸è¿‡...ç¡®å®æŒºå¥½ç¬‘çš„ğŸ˜„"
        ];
        showDialogue('aobai', responses[Math.floor(Math.random() * responses.length)]);
    }, 1500);
    
    // æ›´æ–°ç•Œé¢
    updateMood();
    createParticleEffect('sparkle', 10, window.innerWidth / 2, window.innerHeight / 2);
}

function confessFeelings() {
    // æ£€æŸ¥å…³ç³»ç­‰çº§
    if (GAME_STATE.relationship.intimacy < 70) {
        showDialogue('lein', "æˆ‘...æˆ‘å…¶å®æœ‰è¯æƒ³è¯´...ï¼ˆä½†è¿˜æ²¡å‡†å¤‡å¥½ï¼‰");
        return;
    }
    
    // éšæœºå†³å®šè¡¨ç™½ç±»å‹
    const confessType = Math.random() > 0.5 ? 'nervous' : 'playful';
    const confessions = DIALOGUES.lein[confessType];
    const confession = confessions[Math.floor(Math.random() * confessions.length)];
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    GAME_STATE.lein.secretFeelings = Math.min(100, GAME_STATE.lein.secretFeelings + 20);
    GAME_STATE.lein.mood = Math.min(100, GAME_STATE.lein.mood - 10); // ç´§å¼ å¯¼è‡´å¿ƒæƒ…ä¸‹é™
    
    // é³Œæ‹œçš„ååº”å–å†³äºå½“å‰å…³ç³»
    let aobaiResponse;
    if (GAME_STATE.aobai.affection > 60) {
        aobaiResponse = "é›·æ©...æˆ‘å…¶å®ä¹Ÿ...ï¼ˆè„¸çº¢ï¼‰";
        GAME_STATE.aobai.affection += 10;
        GAME_STATE.relationship.level = Math.min(5, GAME_STATE.relationship.level + 1);
    } else if (GAME_STATE.aobai.affection > 30) {
        aobaiResponse = "è¯¶ï¼Ÿçªç„¶è¯´è¿™ä¸ª...è®©æˆ‘æœ‰ç‚¹ä¸çŸ¥æ‰€æª...";
        GAME_STATE.aobai.mood -= 10;
    } else {
        aobaiResponse = "é›·æ©ï¼Œæˆ‘ä»¬æ˜¯å¥½æœ‹å‹å¯¹å§ï¼Ÿä¸è¦è¯´è¿™ç§è®©äººå›°æ‰°çš„è¯...";
        GAME_STATE.aobai.mood -= 20;
        GAME_STATE.aobai.affection -= 5;
    }
    
    // æ˜¾ç¤ºå¯¹è¯
    showDialogue('lein', confession);
    
    setTimeout(() => {
        showDialogue('aobai', aobaiResponse);
        
        // å¦‚æœæ˜¯æ­£é¢å›åº”ï¼Œè§¦å‘ç‰¹æ®Šæ—¶åˆ»
        if (GAME_STATE.aobai.affection > 60 && GAME_STATE.relationship.level >= 3) {
            setTimeout(() => {
                showSpecialMoment("å¿ƒæ„ç›¸é€š", "ä¸¤é¢—å¿ƒçš„è·ç¦»ï¼ŒåŸæ¥åªæœ‰ä¸€é¦–æ­Œçš„è·ç¦»", "ğŸ’");
            }, 2000);
        }
    }, 2000);
    
    // æ›´æ–°ç•Œé¢
    updateMood();
    
    // åˆ›å»ºå¿ƒè·³ç²’å­æ•ˆæœ
    for (let i = 0; i < 30; i++) {
        setTimeout(() => {
            createParticleEffect('heart', 3, 
                window.innerWidth / 2 + (Math.random() - 0.5) * 100,
                window.innerHeight / 2 + (Math.random() - 0.5) * 100
            );
        }, i * 100);
    }
}

function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // æ›´æ–°å¹¶ç»˜åˆ¶æ‰€æœ‰ç²’å­
    particles = particles.filter(particle => particle.update());
    particles.forEach(particle => particle.draw());
    
    requestAnimationFrame(animateParticles);
}

// ========== åˆå§‹åŒ–å‡½æ•° ==========
function init() {
    console.log("ğŸµ å¤å¤œçƒŸç«æ¸¸æˆåˆå§‹åŒ–...");
    
    // åˆå§‹åŒ–ç”»å¸ƒ
    canvas = document.getElementById('canvas');
    ctx = canvas.getContext('2d');
    
    // è®¾ç½®ç”»å¸ƒå°ºå¯¸
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // å¼€å§‹ç²’å­åŠ¨ç”»
    animateParticles();
    
    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    document.getElementById('sendGiftBtn').addEventListener('click', sendGift);
    document.getElementById('requestSongBtn').addEventListener('click', requestSong);
    document.getElementById('tellJokeBtn').addEventListener('click', tellJoke);
    document.getElementById('confessBtn').addEventListener('click', confessFeelings);
    
    // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
    document.querySelectorAll('.interaction-btn').forEach(btn => {
        btn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.style.transform = 'scale(0.95)';
        });
        
        btn.addEventListener('touchend', function(e) {
            e.preventDefault();
            this.style.transform = 'scale(1)';
        });
    });
    
    // åˆå§‹å¯¹è¯
    setTimeout(() => {
        showDialogue('aobai', "æ¬¢è¿æ¥åˆ°æˆ‘çš„è¯­éŸ³å…ï¼ä»Šå¤©è¦å¬ä»€ä¹ˆæ­Œå‘¢ï¼Ÿ");
    }, 1000);
    
    setTimeout(() => {
        showDialogue('lein', "é³Œæ‹œï¼æˆ‘ä»Šå¤©ç¬¬ä¸€ä¸ªåˆ°ï¼æƒ³å¬ä½ å”±ã€Šå‹¾æŒ‡èµ·èª“ã€‹ï½");
    }, 2500);
    
    // æ›´æ–°åˆå§‹çŠ¶æ€
    updateMood();
    
    // æ¨¡æ‹Ÿå¬ä¼—æ•°é‡å˜åŒ–
    setInterval(() => {
        const baseCount = 1; // é›·æ©å§‹ç»ˆåœ¨çº¿
        const randomCount = Math.floor(Math.random() * 10);
        document.getElementById('audienceCount').textContent = baseCount + randomCount;
    }, 5000);
    
    // æ¯æ—¥æ›´æ–°
    setInterval(() => {
        GAME_STATE.dayCount++;
        console.log(`ğŸ“… è¿›å…¥ç¬¬ ${GAME_STATE.dayCount} å¤©`);
        
        // æ¯å¤©æ¢å¤ä¸€äº›èƒ½é‡
        GAME_STATE.aobai.energy = Math.min(100, GAME_STATE.aobai.energy + 30);
        GAME_STATE.lein.energy = Math.min(100, GAME_STATE.lein.energy + 40);
        
        // å¿ƒæƒ…è‡ªç„¶å˜åŒ–
        GAME_STATE.aobai.mood = Math.max(0, GAME_STATE.aobai.mood - 5);
        GAME_STATE.lein.mood = Math.max(0, GAME_STATE.lein.mood - 3);
        
        updateMood();
    }, 30000); // æ¯30ç§’æ¨¡æ‹Ÿä¸€å¤©
    
    console.log("âœ… æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼");
}

// ========== æ¸¸æˆå¯åŠ¨ ==========
window.addEventListener('DOMContentLoaded', init);
```


