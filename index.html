<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤å¤œçƒŸç«- é›·æ©ä¸é³Œæ‹œçš„éŸ³ä¹æ•…äº‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* æ‰€æœ‰åŸæœ‰CSSæ ·å¼ä¿æŒä¸å˜ï¼Œåªæ·»åŠ ä¸€äº›æ–°æ ·å¼ */
        /* ... åŸæœ‰CSSæ ·å¼ ... */
        
        .audio-notice {
            margin-top: 10px;
            padding: 10px;
            background: rgba(247, 37, 133, 0.1);
            border-radius: 8px;
            color: #f72585;
            font-size: 0.9rem;
            text-align: center;
            border: 1px dashed #f72585;
            animation: pulse 2s infinite;
        }
        
        .simulation-mode {
            background: rgba(76, 201, 240, 0.1);
            border: 1px solid #4cc9f0;
            color: #4cc9f0;
        }
        
        .audio-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            margin-top: 5px;
            color: #b8b8d1;
        }
        
        .audio-status i {
            color: #4cc9f0;
        }
        
        @keyframes music-note {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-20px); opacity: 0; }
        }
        
        .music-note {
            position: absolute;
            color: #f72585;
            font-size: 1rem;
            animation: music-note 1s ease-out forwards;
            pointer-events: none;
        }
        
        .album-cover {
            position: relative;
            overflow: hidden;
        }
        
        .playing-animation {
            animation: spin 10s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-microphone-alt"></i> è¯­éŸ³å… Â· éŸ³ä¹ä¸å‹æƒ…</h1>
            <p class="subtitle">é›·æ©ä¸é³Œæ‹œçš„éŸ³ä¹æ•…äº‹ - ä»ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹åˆ°ã€Šå‹¾æŒ‡èµ·èª“ã€‹</p>
            <div class="character-info">
                <div class="character-card">
                    <div class="character-avatar aobai-avatar">
                        <i class="fas fa-music"></i>
                    </div>
                    <div class="character-name aobai-name">é³Œæ‹œ</div>
                    <div class="character-role">è¯­éŸ³å…æ­Œæ‰‹</div>
                    <div class="mood-indicator">
                        <span>å¿ƒæƒ…å€¼:</span>
                        <span class="mood-value" id="aobaiMoodValue">85/100</span>
                    </div>
                </div>
                <div class="character-card">
                    <div class="character-avatar lien-avatar">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="character-name lien-name">é›·æ©</div>
                    <div class="character-role">å¿ å®å¬ä¼— Â· å¤´å·ç²‰ä¸</div>
                    <div class="mood-indicator">
                        <span>å¥½æ„Ÿåº¦:</span>
                        <span class="mood-value" id="lienFeelingValue">92/100</span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="left-column">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-comments"></i> è¯­éŸ³å…å¯¹è¯</h2>
                    <div class="dialogue-container" id="dialogueContainer">
                        <!-- å¯¹è¯å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <div class="interaction-controls">
                        <button class="interaction-btn" id="cheerBtn">
                            <i class="fas fa-smile"></i> é€—é³Œæ‹œå¼€å¿ƒ
                        </button>
                        <button class="interaction-btn" id="apologizeBtn">
                            <i class="fas fa-hands-helping"></i> å‘é³Œæ‹œé“æ­‰
                        </button>
                        <button class="gift-btn interaction-btn" id="giftBtn">
                            <i class="fas fa-gift"></i> èµ é€ç¤¼ç‰©
                        </button>
                        <button class="interaction-btn danger-btn" id="teaseBtn">
                            <i class="fas fa-grin-tongue-wink"></i> è°ƒä¾ƒé³Œæ‹œ
                        </button>
                    </div>
                    
                    <div class="gift-container" id="giftContainer" style="display:none;">
                        <div class="gift-item" data-gift="mic">
                            <i class="fas fa-microphone"></i>
                            <div>å®šåˆ¶éº¦å…‹é£</div>
                        </div>
                        <div class="gift-item" data-gift="flower">
                            <i class="fas fa-spa"></i>
                            <div>è™šæ‹ŸèŠ±æŸ</div>
                        </div>
                        <div class="gift-item" data-gift="cake">
                            <i class="fas fa-birthday-cake"></i>
                            <div>ç”Ÿæ—¥è›‹ç³•</div>
                        </div>
                        <div class="gift-item" data-gift="star">
                            <i class="fas fa-star"></i>
                            <div>è¶…çº§æ˜Ÿæ˜Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- æ·»åŠ éŸ³é¢‘æç¤º -->
                    <div class="audio-notice" id="audioNotice">
                        <i class="fas fa-info-circle"></i> 
                        ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹éŸ³ä¹ä½“éªŒï¼ä½¿ç”¨æ¨¡æ‹ŸéŸ³é¢‘æä¾›å®Œæ•´çš„äº¤äº’æ„Ÿå—ã€‚
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-history"></i> äº’åŠ¨è®°å½•</h2>
                    <div class="history-log" id="historyLog">
                        <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="right-column">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-music"></i> éŸ³ä¹æ’­æ”¾å™¨</h2>
                    <div class="music-player">
                        <div class="song-info">
                            <div class="album-cover" id="albumCover">
                                <i class="fas fa-compact-disc"></i>
                            </div>
                            <div class="song-details">
                                <div class="song-title" id="currentSongTitle">æœ€åä¸€é¦–æƒ…æ­Œ</div>
                                <div class="song-artist" id="currentSongArtist">è‹ç›</div>
                                <div class="audio-status" id="audioStatus">
                                    <i class="fas fa-headphones"></i>
                                    <span>ç‚¹å‡»æ’­æ”¾å¼€å§‹éŸ³ä¹</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="visualizer" id="visualizer">
                            <!-- éŸ³ä¹å¯è§†åŒ–æ•ˆæœ -->
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar">
                                <div class="progress" id="songProgress"></div>
                            </div>
                            <div class="meter-label">
                                <span id="currentTime">0:00</span>
                                <span id="totalTime">3:45</span>
                            </div>
                        </div>
                        
                        <div class="player-controls">
                            <button class="control-btn" id="prevBtn">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="control-btn play-btn" id="playBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" id="nextBtn">
                                <i class="fas fa-step-forward"></i>
                            </button>
                        </div>
                        
                        <div class="volume-control">
                            <i class="fas fa-volume-up" style="color:#4cc9f0"></i>
                            <input type="range" min="0" max="100" value="70" class="volume-slider" id="volumeSlider">
                        </div>
                        
                        <div class="lyrics-container" id="lyricsContainer">
                            <!-- æ­Œè¯æ˜¾ç¤º -->
                        </div>
                        
                        <div class="song-list">
                            <div class="song-item active" data-song="0">
                                <i class="fas fa-play-circle"></i>
                                <div>
                                    <div>æœ€åä¸€é¦–æƒ…æ­Œ</div>
                                    <div style="font-size:0.8rem;color:#b8b8d1">è‹ç› Â· åˆé‡ä¹‹æ­Œ</div>
                                </div>
                            </div>
                            <div class="song-item" data-song="1">
                                <i class="fas fa-music"></i>
                                <div>
                                    <div>ä»Šå¤œæœ‰é›¨</div>
                                    <div style="font-size:0.8rem;color:#b8b8d1">é˜Ÿé•¿ Â· æ„ŸåŠ¨ä¹‹å¤œ</div>
                                </div>
                            </div>
                            <div class="song-item" data-song="2">
                                <i class="fas fa-music"></i>
                                <div>
                                    <div>å¤å¤œæœ€åçš„çƒŸç«</div>
                                    <div style="font-size:0.8rem;color:#b8b8d1">å¼ é½å±± Â· å’Œè§£æ—¶åˆ»</div>
                                </div>
                            </div>
                            <div class="song-item" data-song="3">
                                <i class="fas fa-music"></i>
                                <div>
                                    <div>å‹¾æŒ‡èµ·èª“</div>
                                    <div style="font-size:0.8rem;color:#b8b8d1">çº¦å®šä¹‹æ›²</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-heart"></i> å…³ç³»è¿›å±•</h2>
                    <div class="relationship-meter">
                        <div class="meter-container">
                            <div class="meter-fill" id="relationshipMeter"></div>
                        </div>
                        <div class="meter-label">
                            <span>é™Œç”Ÿäºº</span>
                            <span>å¥½å‹</span>
                            <span>ç‰¹åˆ«çš„äºº</span>
                        </div>
                    </div>
                    
                    <div class="story-progress">
                        <div class="milestone completed">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <div>åˆæ¬¡ç›¸é‡</div>
                                <div style="font-size:0.8rem;color:#b8b8d1">ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹ç›¸è¯†</div>
                            </div>
                        </div>
                        <div class="milestone completed">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <div>æ„ŸåŠ¨ä¹‹å¤œ</div>
                                <div style="font-size:0.8rem;color:#b8b8d1">ã€Šä»Šå¤œæœ‰é›¨ã€‹å…¥è¿·</div>
                            </div>
                        </div>
                        <div class="milestone active">
                            <i class="fas fa-star"></i>
                            <div>
                                <div>çŸ›ç›¾ä¸å’Œè§£</div>
                                <div style="font-size:0.8rem;color:#b8b8d1">ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹</div>
                            </div>
                        </div>
                        <div class="milestone">
                            <i class="fas fa-lock"></i>
                            <div>
                                <div>å‹¾æŒ‡èµ·èª“</div>
                                <div style="font-size:0.8rem;color:#b8b8d1">æ°¸è¿œçš„ç²‰ä¸</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>è¯­éŸ³å…æ•…äº‹ Â· é›·æ©ä¸é³Œæ‹œçš„éŸ³ä¹æ—…ç¨‹ | è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼éŸ³ä¹æ•…äº‹ä½“éªŒ</p>
            <p>ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹éŸ³ä¹æ—…ç¨‹ï¼Œäº«å—å®Œæ•´çš„æ•…äº‹æƒ…èŠ‚å’Œäº’åŠ¨ä½“éªŒ</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ–å˜é‡
        let aobaiMood = 85;
        let lienFeeling = 92;
        let relationshipLevel = 75;
        let currentSongIndex = 0;
        let isPlaying = false;
        let songProgress = 0;
        let audioContext;
        let analyser;
        let dataArray;
        let bufferLength;
        let visualizerBars = [];
        let currentDialogueIndex = 0;
        let autoDialogueTimer;
        let giftSent = false;
        let simulationMode = true; // ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼
        let currentTime = 0;
        let songDuration = 225; // 3åˆ†45ç§’
        let progressInterval;
        
        // æ­Œæ›²æ•°æ® - æŒ‰ç…§æƒ…æ„Ÿçº¿å‘å±•
        const songs = [
            { 
                title: "æœ€åä¸€é¦–æƒ…æ­Œ", 
                artist: "è‹ç›", 
                duration: "3:45", 
                special: "é›·æ©ç¬¬ä¸€æ¬¡å¬é³Œæ‹œå”±çš„æ­Œ",
                storyStage: "åˆé‡",
                lyrics: [
                    {time: 0, text: "è¿™æ˜¯æˆ‘ä»¬åˆé‡çš„é‚£é¦–æ­Œ"},
                    {time: 10, text: "è®°å¾—é‚£å¤©ä½ ç¬¬ä¸€æ¬¡æ¥æˆ‘çš„è¯­éŸ³å…"},
                    {time: 20, text: "ç‚¹äº†è¿™é¦–æ­Œï¼Œè¯´å–œæ¬¢æˆ‘çš„å£°éŸ³"},
                    {time: 30, text: "ä»é‚£æ—¶èµ·ï¼Œä½ å°±æˆäº†æˆ‘çš„å¸¸å®¢"}
                ],
                audioUrl: "https://cdn.pixabay.com/download/audio/2022/03/10/audio_6d1d232857.mp3?filename=melody-loops-prelude-6211.mp3"
            },
            { 
                title: "ä»Šå¤œæœ‰é›¨", 
                artist: "é˜Ÿé•¿", 
                duration: "4:12", 
                special: "è®©é›·æ©æ„ŸåŠ¨è½æ³ªçš„æ­Œæ›²",
                storyStage: "å…¥è¿·",
                lyrics: [
                    {time: 0, text: "é‚£å¤©ä¸‹ç€é›¨ï¼Œæˆ‘å¿ƒæƒ…å¾ˆä½è½"},
                    {time: 15, text: "ä½ ä¸ºæˆ‘å”±äº†è¿™é¦–æ­Œ"},
                    {time: 30, text: "ä½ çš„æ­Œå£°åƒé˜³å…‰ä¸€æ ·æ¸©æš–"},
                    {time: 45, text: "æˆ‘ç¬¬ä¸€æ¬¡åœ¨è¯­éŸ³å…å“­äº†"}
                ],
                audioUrl: "https://cdn.pixabay.com/download/audio/2022/03/15/audio_d0b50d39af.mp3?filename=melodic-drive-words-11889.mp3"
            },
            { 
                title: "å¤å¤œæœ€åçš„çƒŸç«", 
                artist: "å¼ é½å±±", 
                duration: "3:58", 
                special: "ä¸¤äººå’Œè§£çš„æ—¶åˆ»",
                storyStage: "å’Œè§£",
                lyrics: [
                    {time: 0, text: "è®°å¾—æˆ‘ä»¬é—¹çŸ›ç›¾çš„é‚£å¤©"},
                    {time: 12, text: "æˆ‘ç”Ÿä½ çš„æ°”ï¼Œä½ å´ä¸æ˜ç™½ä¸ºä»€ä¹ˆ"},
                    {time: 25, text: "åæ¥ä½ ä¸ºæˆ‘å”±äº†è¿™é¦–æ­Œ"},
                    {time: 40, text: "å¤å¤œçš„çƒŸç«ä¸‹ï¼Œæˆ‘ä»¬å’Œå¥½äº†"}
                ],
                audioUrl: "https://cdn.pixabay.com/download/audio/2022/01/18/audio_2c3f3e9a8e.mp3?filename=inspiring-cinematic-ambient-116199.mp3"
            },
            { 
                title: "å‹¾æŒ‡èµ·èª“", 
                artist: "çº¦å®šä¹‹æ›²", 
                duration: "4:20", 
                special: "å¯¹ä¸¤äººéƒ½æœ‰ç‰¹æ®Šæ„ä¹‰çš„æ­Œ",
                storyStage: "çº¦å®š",
                lyrics: [
                    {time: 0, text: "ä½ è¯´è¦æ°¸è¿œåšæˆ‘çš„å¤´å·ç²‰ä¸"},
                    {time: 18, text: "æˆ‘è¯´ä½ æ˜¯æˆ‘æœ€é‡è¦çš„äºº"},
                    {time: 35, text: "æˆ‘ä»¬å‹¾æŒ‡èµ·èª“ï¼Œæ°¸ä¸åˆ†ç¦»"},
                    {time: 50, text: "å“ªæ€•åªæ˜¯ä½œä¸ºæœ€å¥½çš„æœ‹å‹"}
                ],
                audioUrl: "https://cdn.pixabay.com/download/audio/2022/01/18/audio_87436e4cd3.mp3?filename=emotional-inspiring-piano-112623.mp3"
            }
        ];
        
        // å¯¹è¯æ•°æ® - æŒ‰æ­Œæ›²èŠ‚å¥ç»„ç»‡
        const songDialogues = {
            0: [ // æœ€åä¸€é¦–æƒ…æ­Œ - åˆé‡
                { sender: "ç³»ç»Ÿ", message: "ğŸµ é³Œæ‹œå¼€å§‹æ¼”å”±ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹...", type: "system", delay: 1000 },
                { sender: "é›·æ©", message: "ç¬¬ä¸€æ¬¡å¬ä½ å”±è¿™é¦–æ­Œï¼Œå£°éŸ³çœŸå¥½å¬ï¼", type: "lien", delay: 3000 },
                { sender: "é³Œæ‹œ", message: "è°¢è°¢~ä½ æ˜¯æ–°æ¥çš„å¬ä¼—å—ï¼Ÿ", type: "aobai", delay: 5000 },
                { sender: "é›·æ©", message: "æ˜¯çš„ï¼ä»¥åæˆ‘ä¼šå¸¸æ¥çš„ï¼", type: "lien", delay: 7000 }
            ],
            1: [ // ä»Šå¤œæœ‰é›¨ - å…¥è¿·
                { sender: "ç³»ç»Ÿ", message: "ğŸŒ§ï¸ ä»Šæ™šå¤–é¢ä¸‹ç€é›¨ï¼Œé³Œæ‹œæ¼”å”±ã€Šä»Šå¤œæœ‰é›¨ã€‹...", type: "system", delay: 1000 },
                { sender: "é›·æ©", message: "ä½ çš„æ­Œå£°...è®©æˆ‘æƒ³èµ·äº†å¾ˆå¤šå¾€äº‹...", type: "lien", delay: 4000 },
                { sender: "é³Œæ‹œ", message: "é›·æ©ï¼Œä½ æ²¡äº‹å§ï¼Ÿå£°éŸ³æœ‰ç‚¹å“½å’½...", type: "aobai", delay: 7000 },
                { sender: "é›·æ©", message: "æ²¡äº‹...åªæ˜¯ä½ çš„æ­Œå£°å¤ªåŠ¨äººäº†...", type: "lien", delay: 10000 }
            ],
            2: [ // å¤å¤œæœ€åçš„çƒŸç« - å’Œè§£
                { sender: "ç³»ç»Ÿ", message: "ğŸ† å¤å¤œï¼Œé³Œæ‹œæ¼”å”±ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹...", type: "system", delay: 1000 },
                { sender: "é³Œæ‹œ", message: "é›·æ©ï¼Œå¯¹ä¸èµ·ï¼Œæ˜¨å¤©æˆ‘ä¸è¯¥å¯¹ä½ å‘è„¾æ°”...", type: "aobai", delay: 3000 },
                { sender: "é›·æ©", message: "ä¸ï¼Œæ˜¯æˆ‘ä¸å¥½...æˆ‘ä¸è¯¥è¦æ±‚å¤ªå¤š...", type: "lien", delay: 6000 },
                { sender: "é³Œæ‹œ", message: "ä½ æ°¸è¿œæ˜¯æˆ‘æœ€é‡è¦çš„æœ‹å‹ï¼Œé›·æ©ã€‚", type: "aobai", delay: 9000 },
                { sender: "é›·æ©", message: "å—¯...æˆ‘ä¼šæ°¸è¿œåšä½ çš„å¤´å·ç²‰ä¸ï¼", type: "lien", delay: 12000 }
            ],
            3: [ // å‹¾æŒ‡èµ·èª“ - çº¦å®š
                { sender: "ç³»ç»Ÿ", message: "ğŸ’« ç‰¹åˆ«æ—¶åˆ»ï¼Œé³Œæ‹œæ¼”å”±ã€Šå‹¾æŒ‡èµ·èª“ã€‹...", type: "system", delay: 1000 },
                { sender: "é›·æ©", message: "é³Œæ‹œ...æˆ‘...", type: "lien", delay: 4000 },
                { sender: "é³Œæ‹œ", message: "é›·æ©ï¼Œæˆ‘çŸ¥é“ä½ æƒ³è¯´ä»€ä¹ˆ...", type: "aobai", delay: 7000 },
                { sender: "é³Œæ‹œ", message: "ä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€ç‰¹åˆ«çš„äººï¼Œä½†...", type: "aobai", delay: 10000 },
                { sender: "é›·æ©", message: "æˆ‘æ˜ç™½...èƒ½ä¸€ç›´å¬ä½ å”±æ­Œå°±è¶³å¤Ÿäº†...", type: "lien", delay: 13000 },
                { sender: "é³Œæ‹œ", message: "æˆ‘ä»¬å‹¾æŒ‡èµ·èª“ï¼Œæ°¸è¿œæ˜¯æœ€å¥½çš„æœ‹å‹ï¼", type: "aobai", delay: 16000 }
            ]
        };
        
        // å¸¸è§„äº’åŠ¨å¯¹è¯
        const cheerOptions = [
            "é³Œæ‹œä½ ä»Šå¤©çš„å¦†å‘å¥½ç¾ï¼å”±æ­Œä¹Ÿè¶…å¥½å¬ï¼",
            "æˆ‘å¸®ä½ ç”»äº†å¼ åº”æ´å›¾ï¼Œå‘åœ¨ç²‰ä¸ç¾¤é‡Œäº†ï¼",
            "ä»Šå¤©æ˜¯ä¸æ˜¯åˆç»ƒä¹ åˆ°å¾ˆæ™šï¼Ÿè¦æ³¨æ„ä¼‘æ¯å‘€ï¼",
            "ä½ å”±å¾—è¶Šæ¥è¶Šå¥½äº†ï¼Œæˆ‘ä¸ºä½ éª„å‚²ï¼"
        ];
        
        const apologizeOptions = [
            "å¯¹ä¸èµ·ï¼Œæ˜¨å¤©æˆ‘ä¸è¯¥é‚£ä¹ˆä»»æ€§...",
            "æˆ‘é”™äº†ï¼Œæˆ‘ä¸è¯¥åœ¨ä½ ç»ƒæ­Œçš„æ—¶å€™æ‰“æ‰°ä½ ...",
            "æŠ±æ­‰ï¼Œæˆ‘æ˜¯ä¸æ˜¯åˆç»™ä½ å¤ªå¤§å‹åŠ›äº†ï¼Ÿ",
            "å¯¹ä¸èµ·å˜›ï¼Œæˆ‘ä¿è¯ä¸ä¼šå†è®©ä½ ç”Ÿæ°”äº†..."
        ];
        
        const teaseOptions = [
            "é³Œæ‹œä½ æ˜¯ä¸æ˜¯åˆå·å·åƒè¾£çš„äº†ï¼Ÿå£°éŸ³æœ‰ç‚¹å“‘å“¦~",
            "ä»Šå¤©æ˜¯ä¸æ˜¯åˆç¡è¿‡å¤´æ²¡å¼€å—“ï¼ŸçŠ¶æ€ä¸å¤ªå¯¹~",
            "ä½ åˆšæ‰æ˜¯ä¸æ˜¯å¿˜è¯äº†ï¼Ÿæˆ‘éƒ½å¬å‡ºæ¥äº†ï¼",
            "é³Œæ‹œï¼Œä½ ç²‰ä¸è¯´ä½ æœ€è¿‘å˜ç¾äº†ï¼Œæ˜¯ä¸æ˜¯æ‹çˆ±äº†ï¼Ÿ"
        ];
        
        const giftOptions = [
            { type: "mic", name: "å®šåˆ¶éº¦å…‹é£", message: "é€ä½ ä¸€ä¸ªå®šåˆ¶éº¦å…‹é£ï¼Œå¸Œæœ›ä½ å”±å¾—æ›´å¥½ï¼", response: "å“‡ï¼è¿™ä¸ªéº¦å…‹é£å¥½æ¼‚äº®ï¼è°¢è°¢ä½ é›·æ©ï¼" },
            { type: "flower", name: "è™šæ‹ŸèŠ±æŸ", message: "é€ä½ ä¸€æŸèŠ±ï¼Œç¥ä½ ä»Šå¤©å¿ƒæƒ…ç¾ä¸½~", response: "å¥½ç¾çš„èŠ±ï¼é›·æ©ä½ çœŸè´´å¿ƒï¼" },
            { type: "cake", name: "ç”Ÿæ—¥è›‹ç³•", message: "è™½ç„¶ä¸æ˜¯ä½ ç”Ÿæ—¥ï¼Œä½†æˆ‘æƒ³ç»™ä½ åº†ç¥ï¼", response: "å“ˆå“ˆï¼Œä½ æ€»æ˜¯è¿™ä¹ˆæœ‰è¶£ï¼è°¢è°¢ä½ çš„è›‹ç³•ï¼" },
            { type: "star", name: "è¶…çº§æ˜Ÿæ˜Ÿ", message: "é€ä½ ä¸€é¢—æ˜Ÿæ˜Ÿï¼Œä½ åœ¨æˆ‘å¿ƒé‡Œæ°¸è¿œé—ªè€€ï¼", response: "é›·æ©...ä½ æ€»æ˜¯è®©æˆ‘è¿™ä¹ˆæ„ŸåŠ¨..." }
        ];
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            console.log("åˆå§‹åŒ–è¯­éŸ³å…...");
            
            // æ¸²æŸ“åˆå§‹å¯¹è¯
            renderInitialDialogues();
            
            // æ›´æ–°å…³ç³»è¿›åº¦æ¡
            updateRelationshipMeter();
            
            // æ›´æ–°æ­Œæ›²ä¿¡æ¯
            updateSongInfo();
            
            // åˆå§‹åŒ–å¯è§†åŒ–æ•ˆæœ
            initVisualizer();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('cheerBtn').addEventListener('click', () => interact('cheer'));
            document.getElementById('apologizeBtn').addEventListener('click', () => interact('apologize'));
            document.getElementById('teaseBtn').addEventListener('click', () => interact('tease'));
            document.getElementById('giftBtn').addEventListener('click', toggleGiftContainer);
            
            // éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶
            document.getElementById('playBtn').addEventListener('click', togglePlay);
            document.getElementById('prevBtn').addEventListener('click', prevSong);
            document.getElementById('nextBtn').addEventListener('click', nextSong);
            document.getElementById('progressBar').addEventListener('click', seekSong);
            document.getElementById('volumeSlider').addEventListener('input', changeVolume);
            
            // æ­Œæ›²é€‰æ‹©
            document.querySelectorAll('.song-item').forEach(item => {
                item.addEventListener('click', function() {
                    const songIndex = parseInt(this.getAttribute('data-song'));
                    selectSong(songIndex);
                });
            });
            
            // ç¤¼ç‰©é€‰æ‹©
            document.querySelectorAll('.gift-item').forEach(item => {
                item.addEventListener('click', function() {
                    const giftType = this.getAttribute('data-gift');
                    sendGift(giftType);
                });
            });
            
            // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
            initAudioContext();
            
            // æ›´æ–°å¿ƒæƒ…æŒ‡ç¤ºå™¨
            updateMoodIndicators();
            
            // æ›´æ–°éŸ³é¢‘çŠ¶æ€
            updateAudioStatus();
            
            console.log("è¯­éŸ³å…åˆå§‹åŒ–å®Œæˆï¼ä½¿ç”¨æ¨¡æ‹ŸéŸ³é¢‘æ¨¡å¼");
        }
        
        // åˆå§‹åŒ–å¯è§†åŒ–æ•ˆæœ
        function initVisualizer() {
            console.log("åˆå§‹åŒ–å¯è§†åŒ–æ•ˆæœ...");
            const visualizer = document.getElementById('visualizer');
            visualizer.innerHTML = '';
            
            // åˆ›å»ºå¯è§†åŒ–æ¡
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = '10px';
                visualizer.appendChild(bar);
                visualizerBars.push(bar);
            }
            console.log("å¯è§†åŒ–æ•ˆæœåˆå§‹åŒ–å®Œæˆ");
        }
        
        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
        function initAudioContext() {
            console.log("åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡...");
            try {
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒWeb Audio API
                if (window.AudioContext || window.webkitAudioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log("éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–æˆåŠŸ");
                } else {
                    console.warn("æµè§ˆå™¨ä¸æ”¯æŒWeb Audio APIï¼Œå°†ä½¿ç”¨æ¨¡æ‹Ÿå¯è§†åŒ–æ•ˆæœ");
                }
            } catch (e) {
                console.log('Web Audio APIåˆå§‹åŒ–å¤±è´¥:', e);
            }
        }
        
        // æ¨¡æ‹Ÿæ’­æ”¾éŸ³ä¹
        function simulateAudioPlay() {
            console.log("å¼€å§‹æ¨¡æ‹Ÿæ’­æ”¾éŸ³ä¹:", songs[currentSongIndex].title);
            
            // æ›´æ–°éŸ³é¢‘çŠ¶æ€
            updateAudioStatus();
            
            // å¼€å§‹è¿›åº¦æ›´æ–°
            if (progressInterval) clearInterval(progressInterval);
            
            progressInterval = setInterval(() => {
                if (!isPlaying) return;
                
                currentTime += 0.1; // æ¯100æ¯«ç§’å¢åŠ 0.1ç§’
                
                // å¦‚æœåˆ°è¾¾æ­Œæ›²æœ«å°¾ï¼Œå¾ªç¯æ’­æ”¾
                if (currentTime >= songDuration) {
                    currentTime = 0;
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                const progress = (currentTime / songDuration) * 100;
                document.getElementById('songProgress').style.width = `${progress}%`;
                
                // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                const currentMinutes = Math.floor(currentTime / 60);
                const currentSeconds = Math.floor(currentTime % 60);
                document.getElementById('currentTime').textContent = 
                    `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')}`;
                
                // æ›´æ–°æ­Œè¯é«˜äº®
                updateLyricsHighlight(currentTime);
                
                // æ›´æ–°å¯è§†åŒ–æ•ˆæœ
                updateVisualizer();
                
            }, 100);
        }
        
        // æ›´æ–°å¯è§†åŒ–æ•ˆæœ
        function updateVisualizer() {
            if (!isPlaying) return;
            
            for (let i = 0; i < visualizerBars.length; i++) {
                // ç”ŸæˆåŠ¨æ€çš„æŸ±çŠ¶å›¾é«˜åº¦
                const time = Date.now() / 500;
                const baseHeight = 10 + Math.sin(time + i * 0.3) * 15;
                const randomFactor = Math.random() * 10;
                const height = Math.max(10, baseHeight + randomFactor);
                visualizerBars[i].style.height = `${height}px`;
                
                // æ ¹æ®æ•°å€¼æ”¹å˜é¢œè‰²
                if (height > 30) {
                    visualizerBars[i].style.background = 'linear-gradient(to top, #f72585, #ff9a00)';
                } else {
                    visualizerBars[i].style.background = 'linear-gradient(to top, #4cc9f0, #f72585)';
                }
            }
            
            // æ·»åŠ éŸ³ä¹éŸ³ç¬¦åŠ¨ç”»
            if (Math.random() > 0.7) {
                createMusicNote();
            }
        }
        
        // åˆ›å»ºéŸ³ä¹éŸ³ç¬¦åŠ¨ç”»
        function createMusicNote() {
            const albumCover = document.getElementById('albumCover');
            if (!albumCover) return;
            
            const note = document.createElement('div');
            note.className = 'music-note';
            note.innerHTML = '<i class="fas fa-music"></i>';
            
            // éšæœºä½ç½®
            const left = 50 + (Math.random() * 20 - 10);
            note.style.left = `${left}%`;
            note.style.top = '50%';
            
            albumCover.appendChild(note);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                if (note.parentNode) {
                    note.parentNode.removeChild(note);
                }
            }, 1000);
        }
        
        // æ¸²æŸ“åˆå§‹å¯¹è¯
        function renderInitialDialogues() {
            console.log("æ¸²æŸ“åˆå§‹å¯¹è¯...");
            const container = document.getElementById('dialogueContainer');
            container.innerHTML = '';
            
            // æ·»åŠ æ¬¢è¿å¯¹è¯
            addMessage("ç³»ç»Ÿ", "ğŸ¤ æ¬¢è¿æ¥åˆ°é³Œæ‹œçš„è¯­éŸ³å…ï¼", "system");
            setTimeout(() => {
                addMessage("é³Œæ‹œ", "å¤§å®¶å¥½ï¼æˆ‘æ˜¯é³Œæ‹œï¼Œä»Šå¤©æƒ³å¬ä»€ä¹ˆæ­Œå‘¢ï¼Ÿ", "aobai");
            }, 1500);
            setTimeout(() => {
                addMessage("é›·æ©", "é³Œæ‹œé³Œæ‹œï¼ä»Šå¤©å¯ä»¥å”±ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹å—ï¼Ÿ", "lien");
            }, 3000);
            setTimeout(() => {
                addMessage("é³Œæ‹œ", "å½“ç„¶å¯ä»¥å•¦ï¼é›·æ©ä½ åˆæ¥å•¦~", "aobai");
            }, 4500);
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°å¯¹è¯å®¹å™¨
        function addMessage(sender, message, type, instant = false) {
            const container = document.getElementById('dialogueContainer');
            
            // ç§»é™¤æ—§æ¶ˆæ¯çš„åŠ¨ç”»ç±»
            const oldMessages = container.querySelectorAll('.dialogue-message');
            if (oldMessages.length > 8) {
                for (let i = 0; i < oldMessages.length - 8; i++) {
                    oldMessages[i].classList.add('hiding');
                }
                
                // ç¨åç§»é™¤æ—§æ¶ˆæ¯
                setTimeout(() => {
                    for (let i = 0; i < oldMessages.length - 8; i++) {
                        if (oldMessages[i].parentNode) {
                            oldMessages[i].parentNode.removeChild(oldMessages[i]);
                        }
                    }
                }, 500);
            }
            
            const messageDiv = document.createElement('div');
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            if (type === 'system') {
                messageDiv.className = 'dialogue-message system-message';
                messageDiv.innerHTML = `<div class="message-content">${message}</div>`;
            } else {
                const senderClass = type === 'aobai' ? 'aobai-message' : 'lien-message';
                messageDiv.className = `dialogue-message ${senderClass}`;
                
                // å¦‚æœæ˜¯ç‰¹æ®Šæ¶ˆæ¯ï¼ˆåŒ…å«å¿ƒå½¢ï¼‰
                if (message.includes('â¤ï¸') || message.includes('ğŸ’–')) {
                    messageDiv.classList.add('special-message');
                }
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <i class="fas fa-${type === 'aobai' ? 'music' : 'heart'}"></i>
                        ${sender}
                    </div>
                    <div class="message-content">${message}</div>
                    <div class="message-time">${timeString}</div>
                `;
            }
            
            if (!instant) {
                messageDiv.style.opacity = '0';
                messageDiv.style.transform = 'translateY(10px)';
            }
            
            container.appendChild(messageDiv);
            
            if (!instant) {
                setTimeout(() => {
                    messageDiv.style.opacity = '1';
                    messageDiv.style.transform = 'translateY(0)';
                }, 10);
            }
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(`${sender}: ${message}`);
        }
        
        // äº’åŠ¨å‡½æ•°
        function interact(type) {
            let lienMessage, aobaiMessage;
            
            switch(type) {
                case 'cheer':
                    lienMessage = cheerOptions[Math.floor(Math.random() * cheerOptions.length)];
                    aobaiMood = Math.min(100, aobaiMood + 8);
                    lienFeeling = Math.min(100, lienFeeling + 3);
                    relationshipLevel = Math.min(100, relationshipLevel + 4);
                    break;
                    
                case 'apologize':
                    lienMessage = apologizeOptions[Math.floor(Math.random() * apologizeOptions.length)];
                    aobaiMood = Math.min(100, aobaiMood + 10);
                    lienFeeling = Math.min(100, lienFeeling + 2);
                    relationshipLevel = Math.min(100, relationshipLevel + 5);
                    break;
                    
                case 'tease':
                    lienMessage = teaseOptions[Math.floor(Math.random() * teaseOptions.length)];
                    aobaiMood = Math.max(0, aobaiMood - 12);
                    lienFeeling = Math.max(0, lienFeeling - 3);
                    relationshipLevel = Math.max(0, relationshipLevel - 4);
                    break;
            }
            
            // æ·»åŠ å¯¹è¯
            addMessage("é›·æ©", lienMessage, "lien");
            
            // é³Œæ‹œç¨åå›åº”
            setTimeout(() => {
                let response;
                if (type === 'cheer') {
                    response = "è°¢è°¢ä½ é›·æ©ï¼ä½ æ€»æ˜¯è¿™ä¹ˆæš–å¿ƒ~";
                } else if (type === 'apologize') {
                    response = "æ²¡å…³ç³»å•¦~æˆ‘ä»¬ä¸æ˜¯æœ€å¥½çš„æœ‹å‹å—ï¼Ÿ";
                } else if (type === 'tease') {
                    if (aobaiMood < 40) {
                        response = "é›·æ©ï¼ä½ ä»Šå¤©æ˜¯ä¸æ˜¯æ•…æ„æ¥æ°”æˆ‘çš„ï¼";
                    } else {
                        response = "å“¼ï¼ä½ æ‰çŠ¶æ€ä¸å¯¹å‘¢ï¼";
                    }
                }
                
                addMessage("é³Œæ‹œ", response, "aobai");
                
                // æ›´æ–°å¿ƒæƒ…å’Œå¥½æ„Ÿåº¦
                updateMoodIndicators();
                
                // æ›´æ–°å…³ç³»è¿›åº¦æ¡
                updateRelationshipMeter();
                
                // æ£€æŸ¥ç‰¹æ®Šäº‹ä»¶
                checkSpecialEvents();
            }, 1500);
        }
        
        // èµ é€ç¤¼ç‰©
        function sendGift(giftType) {
            const gift = giftOptions.find(g => g.type === giftType);
            if (!gift) return;
            
            // éšè—ç¤¼ç‰©å®¹å™¨
            document.getElementById('giftContainer').style.display = 'none';
            
            // æ·»åŠ é€ç¤¼å¯¹è¯
            addMessage("é›·æ©", gift.message, "lien");
            
            // æ›´æ–°æ•°å€¼
            aobaiMood = Math.min(100, aobaiMood + 15);
            lienFeeling = Math.min(100, lienFeeling + 5);
            relationshipLevel = Math.min(100, relationshipLevel + 8);
            
            // é³Œæ‹œå›åº”
            setTimeout(() => {
                addMessage("é³Œæ‹œ", gift.response, "aobai");
                
                // æ›´æ–°å¿ƒæƒ…å’Œå¥½æ„Ÿåº¦
                updateMoodIndicators();
                
                // æ›´æ–°å…³ç³»è¿›åº¦æ¡
                updateRelationshipMeter();
                
                // æ ‡è®°å·²é€ç¤¼
                giftSent = true;
                
                // æ£€æŸ¥ç‰¹æ®Šäº‹ä»¶
                checkSpecialEvents();
            }, 1500);
        }
        
        // åˆ‡æ¢ç¤¼ç‰©å®¹å™¨æ˜¾ç¤º
        function toggleGiftContainer() {
            const giftContainer = document.getElementById('giftContainer');
            if (giftContainer.style.display === 'none' || giftContainer.style.display === '') {
                giftContainer.style.display = 'flex';
            } else {
                giftContainer.style.display = 'none';
            }
        }
        
        // æ›´æ–°å¿ƒæƒ…æŒ‡ç¤ºå™¨
        function updateMoodIndicators() {
            document.getElementById('aobaiMoodValue').textContent = `${aobaiMood}/100`;
            document.getElementById('lienFeelingValue').textContent = `${lienFeeling}/100`;
            
            // æ›´æ–°å¿ƒæƒ…é¢œè‰²
            const aobaiMoodElement = document.getElementById('aobaiMoodValue');
            const lienFeelingElement = document.getElementById('lienFeelingValue');
            
            aobaiMoodElement.style.color = aobaiMood > 70 ? '#4cc9f0' : aobaiMood > 40 ? '#ffd700' : '#f72585';
            lienFeelingElement.style.color = lienFeeling > 70 ? '#4cc9f0' : lienFeeling > 40 ? '#ffd700' : '#f72585';
        }
        
        // æ›´æ–°éŸ³é¢‘çŠ¶æ€
        function updateAudioStatus() {
            const audioStatus = document.getElementById('audioStatus');
            if (!audioStatus) return;
            
            if (isPlaying) {
                audioStatus.innerHTML = `<i class="fas fa-volume-up"></i> <span>æ­£åœ¨æ’­æ”¾: ${songs[currentSongIndex].title}</span>`;
                audioStatus.style.color = '#4cc9f0';
                
                // æ›´æ–°ä¸“è¾‘å°é¢åŠ¨ç”»
                const albumCover = document.getElementById('albumCover');
                if (albumCover) {
                    albumCover.classList.add('playing-animation');
                }
            } else {
                audioStatus.innerHTML = `<i class="fas fa-headphones"></i> <span>ç‚¹å‡»æ’­æ”¾å¼€å§‹éŸ³ä¹</span>`;
                audioStatus.style.color = '#b8b8d1';
                
                // åœæ­¢ä¸“è¾‘å°é¢åŠ¨ç”»
                const albumCover = document.getElementById('albumCover');
                if (albumCover) {
                    albumCover.classList.remove('playing-animation');
                }
            }
            
            // æ›´æ–°éŸ³é¢‘æç¤º
            const audioNotice = document.getElementById('audioNotice');
            if (audioNotice) {
                if (simulationMode) {
                    audioNotice.innerHTML = `<i class="fas fa-info-circle"></i> æ¨¡æ‹ŸéŸ³é¢‘æ’­æ”¾ä¸­ - äº«å—å®Œæ•´çš„æ•…äº‹ä½“éªŒ`;
                    audioNotice.className = 'audio-notice simulation-mode';
                } else {
                    audioNotice.innerHTML = `<i class="fas fa-info-circle"></i> æ­£åœ¨æ’­æ”¾éŸ³ä¹ - å®Œæ•´çš„è¯­éŸ³å…ä½“éªŒ`;
                    audioNotice.className = 'audio-notice';
                }
            }
        }
        
        // æ›´æ–°å…³ç³»è¿›åº¦æ¡
        function updateRelationshipMeter() {
            const meterFill = document.getElementById('relationshipMeter');
            meterFill.style.width = `${relationshipLevel}%`;
            
            // æ›´æ–°é‡Œç¨‹ç¢‘
            updateMilestones();
        }
        
        // æ›´æ–°é‡Œç¨‹ç¢‘
        function updateMilestones() {
            const milestones = document.querySelectorAll('.milestone');
            
            if (relationshipLevel >= 90 && !milestones[3].classList.contains('active')) {
                milestones[3].classList.add('active');
                milestones[3].querySelector('i').className = 'fas fa-star';
            }
        }
        
        // æ·»åŠ å†å²è®°å½•
        function addToHistory(log) {
            const historyLog = document.getElementById('historyLog');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            logEntry.textContent = `[${timeString}] ${log}`;
            historyLog.appendChild(logEntry);
            
            // é™åˆ¶è®°å½•æ•°é‡
            if (historyLog.children.length > 10) {
                historyLog.removeChild(historyLog.firstChild);
            }
            
            historyLog.scrollTop = historyLog.scrollHeight;
        }
        
        // éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½
        function updateSongInfo() {
            const song = songs[currentSongIndex];
            document.getElementById('currentSongTitle').textContent = song.title;
            document.getElementById('currentSongArtist').textContent = song.artist;
            document.getElementById('totalTime').textContent = song.duration;
            
            // è®¾ç½®æ­Œæ›²æ—¶é•¿
            songDuration = song.duration === "3:45" ? 225 : 
                          song.duration === "4:12" ? 252 : 
                          song.duration === "3:58" ? 238 : 260;
            
            // æ›´æ–°æ´»è·ƒæ­Œæ›²
            document.querySelectorAll('.song-item').forEach((item, index) => {
                if (index === currentSongIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // æ›´æ–°æ­Œè¯
            updateLyrics();
        }
        
        function togglePlay() {
            const playBtn = document.getElementById('playBtn');
            const playIcon = playBtn.querySelector('i');
            
            if (!isPlaying) {
                // å¼€å§‹æ’­æ”¾
                isPlaying = true;
                playIcon.className = 'fas fa-pause';
                
                // ä½¿ç”¨æ¨¡æ‹ŸéŸ³é¢‘
                simulateAudioPlay();
                
                // æ’­æ”¾æ­Œæ›²å¯¹åº”çš„å¯¹è¯
                playSongDialogues();
                
            } else {
                // æš‚åœæ’­æ”¾
                isPlaying = false;
                playIcon.className = 'fas fa-play';
                
                // æ¸…é™¤è¿›åº¦æ›´æ–°é—´éš”
                if (progressInterval) {
                    clearInterval(progressInterval);
                }
                
                // æ¸…é™¤è‡ªåŠ¨å¯¹è¯å®šæ—¶å™¨
                if (autoDialogueTimer) {
                    clearTimeout(autoDialogueTimer);
                }
            }
            
            // æ›´æ–°éŸ³é¢‘çŠ¶æ€
            updateAudioStatus();
        }
        
        function seekSong(e) {
            const progressBar = document.getElementById('progressBar');
            const rect = progressBar.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            
            currentTime = pos * songDuration;
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            const progress = (currentTime / songDuration) * 100;
            document.getElementById('songProgress').style.width = `${progress}%`;
            
            const currentMinutes = Math.floor(currentTime / 60);
            const currentSeconds = Math.floor(currentTime % 60);
            document.getElementById('currentTime').textContent = 
                `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')}`;
        }
        
        function changeVolume() {
            const volume = document.getElementById('volumeSlider').value / 100;
            // è¿™é‡Œå¯ä»¥æ·»åŠ éŸ³é‡å˜åŒ–çš„è§†è§‰åé¦ˆ
            console.log("éŸ³é‡è®¾ç½®ä¸º:", volume);
        }
        
        function prevSong() {
            currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
            changeSong();
        }
        
        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            changeSong();
        }
        
        function selectSong(index) {
            currentSongIndex = index;
            changeSong();
        }
        
        function changeSong() {
            // é‡ç½®æ—¶é—´å’Œè¿›åº¦
            currentTime = 0;
            
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œå…ˆæš‚åœ
            const wasPlaying = isPlaying;
            if (isPlaying) {
                togglePlay();
            }
            
            // æ›´æ–°æ­Œæ›²ä¿¡æ¯
            updateSongInfo();
            
            // é‡ç½®è¿›åº¦æ¡
            document.getElementById('songProgress').style.width = '0%';
            document.getElementById('currentTime').textContent = '0:00';
            
            // å¦‚æœä¹‹å‰æ­£åœ¨æ’­æ”¾ï¼Œå¼€å§‹æ’­æ”¾æ–°æ­Œ
            if (wasPlaying) {
                setTimeout(() => togglePlay(), 500);
            } else {
                updateAudioStatus();
            }
            
            // æ£€æŸ¥ç‰¹æ®Šäº‹ä»¶
            checkSpecialEvents();
        }
        
        // æ’­æ”¾æ­Œæ›²å¯¹åº”çš„å¯¹è¯
        function playSongDialogues() {
            const dialogues = songDialogues[currentSongIndex];
            if (!dialogues) return;
            
            currentDialogueIndex = 0;
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (autoDialogueTimer) {
                clearTimeout(autoDialogueTimer);
            }
            
            // æ’­æ”¾å¯¹è¯
            function playNextDialogue() {
                if (currentDialogueIndex < dialogues.length) {
                    const dialogue = dialogues[currentDialogueIndex];
                    
                    autoDialogueTimer = setTimeout(() => {
                        addMessage(dialogue.sender, dialogue.message, dialogue.type);
                        currentDialogueIndex++;
                        playNextDialogue();
                    }, dialogue.delay);
                }
            }
            
            playNextDialogue();
        }
        
        // æ›´æ–°æ­Œè¯æ˜¾ç¤º
        function updateLyrics() {
            const lyricsContainer = document.getElementById('lyricsContainer');
            const song = songs[currentSongIndex];
            
            if (!song.lyrics) {
                lyricsContainer.innerHTML = '<div class="current-lyric">æš‚æ— æ­Œè¯</div>';
                return;
            }
            
            let lyricsHTML = '';
            song.lyrics.forEach(lyric => {
                lyricsHTML += `<div class="lyric-line" data-time="${lyric.time}">${lyric.text}</div>`;
            });
            
            lyricsContainer.innerHTML = lyricsHTML;
        }
        
        // æ›´æ–°æ­Œè¯é«˜äº®
        function updateLyricsHighlight(currentTime) {
            const lyricsContainer = document.getElementById('lyricsContainer');
            const lyricLines = lyricsContainer.querySelectorAll('.lyric-line');
            
            let currentLine = null;
            
            // æ‰¾åˆ°å½“å‰æ—¶é—´å¯¹åº”çš„æ­Œè¯
            for (let i = 0; i < lyricLines.length; i++) {
                const line = lyricLines[i];
                const time = parseFloat(line.getAttribute('data-time'));
                
                if (currentTime >= time) {
                    currentLine = line;
                }
            }
            
            // ç§»é™¤æ‰€æœ‰é«˜äº®
            lyricLines.forEach(line => {
                line.classList.remove('current-lyric');
            });
            
            // æ·»åŠ å½“å‰æ­Œè¯é«˜äº®
            if (currentLine) {
                currentLine.classList.add('current-lyric');
                
                // æ»šåŠ¨åˆ°å½“å‰æ­Œè¯
                currentLine.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }
        
        // æ£€æŸ¥ç‰¹æ®Šäº‹ä»¶
        function checkSpecialEvents() {
            // å½“å…³ç³»è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œè§£é”ç‰¹æ®Šå¯¹è¯
            if (relationshipLevel >= 90 && currentSongIndex === 3) {
                // è§£é”å‹¾æŒ‡èµ·èª“ç‰¹æ®Šå‰§æƒ…
                setTimeout(() => {
                    addMessage("ç³»ç»Ÿ", "âœ¨ ç‰¹æ®Šå‰§æƒ…è§£é”ï¼šæ°¸è¿œçš„ç²‰ä¸", "system");
                }, 1000);
            }
            
            // å½“é³Œæ‹œå¿ƒæƒ…å¾ˆä½æ—¶
            if (aobaiMood < 30) {
                setTimeout(() => {
                    addMessage("é³Œæ‹œ", "ä»Šå¤©å¿ƒæƒ…çœŸçš„ä¸å¤ªå¥½...å¯èƒ½æˆ‘è¦ä¸‹æ’­äº†...", "aobai");
                }, 2000);
                
                setTimeout(() => {
                    addMessage("é›·æ©", "åˆ«åˆ«åˆ«ï¼æ˜¯æˆ‘ä¸å¥½ï¼æˆ‘ç»™ä½ å”±é¦–æ­Œèµ”ç½ªå¥½ä¸å¥½ï¼Ÿ", "lien");
                }, 4000);
                
                setTimeout(() => {
                    addMessage("é³Œæ‹œ", "å™—...ä½ äº”éŸ³ä¸å…¨è¿˜å”±æ­Œï¼Ÿç®—äº†ï¼Œçœ‹ä½ è¿™ä¹ˆè¯šæ³ï¼ŒåŸè°…ä½ äº†~", "aobai");
                    aobaiMood += 20;
                    updateMoodIndicators();
                }, 6000);
            }
            
            // å½“é›·æ©å¥½æ„Ÿåº¦å¾ˆé«˜æ—¶
            if (lienFeeling > 95) {
                setTimeout(() => {
                    addMessage("é›·æ©", "å°±åƒæµ·å¸‚èœƒæ¥¼ï¼Œä¸Šå¸æ€»è®©äººæ¯«æ— æŒ‡æœ›åˆä»ä¸åæŠ—ï¼Œä»–è®©ä½ ç”Ÿç—…ï¼Œåˆç»™ä½ è§£è¯...", "lien");
                }, 2000);
                
                setTimeout(() => {
                    addMessage("é³Œæ‹œ", "...", "aobai");
                }, 4000);
            }
            
            // é€ç¤¼åç‰¹æ®Šäº‹ä»¶
            if (giftSent && relationshipLevel > 80) {
                setTimeout(() => {
                    addMessage("é³Œæ‹œ", "é›·æ©ï¼Œè°¢è°¢ä½ ä¸€ç›´ä»¥æ¥çš„æ”¯æŒ...", "aobai");
                }, 3000);
                
                setTimeout(() => {
                    addMessage("é›·æ©", "ä½ æ˜¯æˆ‘æ°¸è¿œçš„å¶åƒï¼Œé³Œæ‹œï¼", "lien");
                }, 6000);
                
                giftSent = false;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
