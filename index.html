```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¤ é³Œæ‹œæ¼”å”±ä¼š | é›·æ©çš„å•µå•µåº”æ´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #1a0b2e 0%, #0d1b2a 100%);
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            height: 100vh;
            color: white;
        }
        
        #canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* ====== èˆå°UI ====== */
        .stage-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .character-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 12px 18px;
            backdrop-filter: blur(10px);
            border: 2px solid;
            min-width: 150px;
        }
        
        #aobai-card {
            border-color: #ff3366;
        }
        
        #lein-card {
            border-color: #33ccff;
        }
        
        .character-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .character-title {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        
        .character-stats {
            display: flex;
            gap: 10px;
            font-size: 14px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* ====== äº’åŠ¨æŒ‰é’® ====== */
        .interaction-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }
        
        .interaction-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .interaction-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }
        
        .interaction-btn:active {
            transform: translateY(0);
        }
        
        /* ====== è§’è‰²å½¢è±¡ ====== */
        .character {
            position: fixed;
            width: 120px;
            height: 180px;
            z-index: 50;
            pointer-events: none;
            transition: all 0.5s ease;
        }
        
        #aobai {
            bottom: 100px;
            left: 20%;
            transform: scaleX(-1); /* é¢å‘å³è¾¹ */
        }
        
        #lein {
            bottom: 100px;
            right: 20%;
        }
        
        .character-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* é³Œæ‹œ - æ­Œæ‰‹é€ å‹ */
        .aobai-head {
            width: 50px;
            height: 50px;
            background: #ff99cc;
            border-radius: 50%;
            margin: 0 auto 10px;
            position: relative;
            border: 3px solid #ff3366;
        }
        
        .aobai-hair {
            width: 70px;
            height: 20px;
            background: #ff3366;
            border-radius: 50% 50% 0 0;
            position: absolute;
            top: -10px;
            left: -10px;
        }
        
        .microphone {
            position: absolute;
            top: 30px;
            right: -30px;
            width: 30px;
            height: 50px;
            background: #333;
            border-radius: 5px;
            transform: rotate(-30deg);
        }
        
        .microphone:before {
            content: '';
            position: absolute;
            top: -10px;
            left: 5px;
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
        }
        
        .music-note {
            position: absolute;
            font-size: 24px;
            animation: floatNote 2s ease-in-out infinite;
            opacity: 0;
        }
        
        /* é›·æ© - ç²‰ä¸é€ å‹ */
        .lein-head {
            width: 50px;
            height: 50px;
            background: #99ccff;
            border-radius: 50%;
            margin: 0 auto 10px;
            position: relative;
            border: 3px solid #33ccff;
        }
        
        .lein-hair {
            width: 70px;
            height: 15px;
            background: #33ccff;
            border-radius: 50% 50% 0 0;
            position: absolute;
            top: -5px;
            left: -10px;
        }
        
        .heart-glasses {
            position: absolute;
            top: 15px;
            left: 0;
            width: 50px;
            height: 20px;
            background: transparent;
            border: 3px solid #ff3366;
            border-radius: 50%;
        }
        
        .heart-glasses:before {
            content: 'â¤';
            position: absolute;
            top: -5px;
            left: 18px;
            font-size: 20px;
            color: #ff3366;
        }
        
        .fan-sign {
            position: absolute;
            top: 30px;
            left: -40px;
            width: 30px;
            height: 40px;
            background: linear-gradient(45deg, #ff3366, #ff6699);
            border-radius: 5px;
            transform: rotate(15deg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        /* ====== å¯¹è¯æ°”æ³¡ ====== */
        .dialogue-bubble {
            position: fixed;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 12px 18px;
            border-radius: 20px;
            max-width: 250px;
            z-index: 200;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .dialogue-bubble:before {
            content: '';
            position: absolute;
            bottom: -10px;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.95);
            transform: rotate(45deg);
        }
        
        #aobai-dialogue {
            bottom: 300px;
            left: 25%;
        }
        
        #aobai-dialogue:before {
            left: 30px;
        }
        
        #lein-dialogue {
            bottom: 300px;
            right: 25%;
        }
        
        #lein-dialogue:before {
            right: 30px;
        }
        
        /* ====== èˆå°æ•ˆæœ ====== */
        .stage-lights {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
            background: radial-gradient(
                ellipse at 30% 20%,
                rgba(255, 51, 102, 0.1) 0%,
                transparent 50%
            ), radial-gradient(
                ellipse at 70% 20%,
                rgba(51, 204, 255, 0.1) 0%,
                transparent 50%
            );
        }
        
        .spotlight {
            position: fixed;
            top: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(
                ellipse at center,
                rgba(255, 255, 255, 0.2) 0%,
                transparent 70%
            );
            filter: blur(20px);
            z-index: 2;
            pointer-events: none;
        }
        
        /* ====== æˆå°±å±•ç¤º ====== */
        .achievement-show {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
            color: #000;
            padding: 30px;
            border-radius: 20px;
            z-index: 300;
            text-align: center;
            min-width: 300px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s;
            box-shadow: 0 20px 50px rgba(255, 215, 0, 0.3);
        }
        
        .achievement-show.show {
            opacity: 1;
        }
        
        .achievement-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .achievement-desc {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        /* ====== åŠ¨ç”»å®šä¹‰ ====== */
        @keyframes floatNote {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 10px currentColor); }
            50% { filter: drop-shadow(0 0 20px currentColor); }
        }
        
        /* ====== å“åº”å¼è°ƒæ•´ ====== */
        @media (max-width: 768px) {
            .stage-ui { flex-direction: column; gap: 10px; }
            .character-card { min-width: 120px; }
            #aobai { left: 10%; }
            #lein { right: 10%; }
            .interaction-buttons { flex-wrap: wrap; justify-content: center; }
            .interaction-btn { padding: 10px 15px; }
        }
    </style>
</head>
<body>
    <!-- ä¸»ç”»å¸ƒ -->
    <canvas id="canvas"></canvas>
    
    <!-- èˆå°ç¯å…‰ -->
    <div class="stage-lights"></div>
    <div class="spotlight" id="spotlight-aobai"></div>
    <div class="spotlight" id="spotlight-lein"></div>
    
    <!-- èˆå°UI -->
    <div class="stage-ui">
        <div class="character-card" id="aobai-card">
            <div class="character-name">
                <span style="color: #ff3366;">ğŸ¤</span> é³Œæ‹œ
            </div>
            <div class="character-title" style="color: #ff99cc;">å®åŠ›æ´¾æ­Œæ‰‹</div>
            <div class="character-stats">
                <div class="stat-item">
                    <span style="color: #ff3366;">ğŸµ</span>
                    <span id="aobai-energy">100</span>
                </div>
                <div class="stat-item">
                    <span style="color: #ff3366;">â¤</span>
                    <span id="aobai-fans">1</span>
                </div>
            </div>
        </div>
        
        <div class="character-card" id="lein-card">
            <div class="character-name">
                <span style="color: #33ccff;">ğŸŒŸ</span> é›·æ©
            </div>
            <div class="character-title" style="color: #99ccff;">å¤´å·ç²‰ä¸</div>
            <div class="character-stats">
                <div class="stat-item">
                    <span style="color: #33ccff;">ğŸ’–</span>
                    <span id="lein-energy">100</span>
                </div>
                <div class="stat-item">
                    <span style="color: #33ccff;">ğŸ«</span>
                    <span id="lein-tickets">âˆ</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è§’è‰²å½¢è±¡ -->
    <div class="character" id="aobai">
        <div class="character-body">
            <div class="aobai-head">
                <div class="aobai-hair"></div>
            </div>
            <div class="microphone"></div>
        </div>
    </div>
    
    <div class="character" id="lein">
        <div class="character-body">
            <div class="lein-head">
                <div class="lein-hair"></div>
                <div class="heart-glasses"></div>
            </div>
            <div class="fan-sign">é³Œ</div>
        </div>
    </div>
    
    <!-- å¯¹è¯æ°”æ³¡ -->
    <div class="dialogue-bubble" id="aobai-dialogue">
        è°¢è°¢é›·æ©ï¼è¿™é¦–ã€Šå•µå•µèƒ½é‡ã€‹é€ç»™ä½ ï¼ğŸµ
    </div>
    
    <div class="dialogue-bubble" id="lein-dialogue">
        é³Œæ‹œå§å§ï¼æˆ‘çˆ±ä½ ï¼ğŸ’–
    </div>
    
    <!-- äº’åŠ¨æŒ‰é’® -->
    <div class="interaction-buttons">
        <button class="interaction-btn" id="send-kiss-btn">
            <span style="color: #ff3366;">ğŸ’‹</span> å‘é€å•µå•µ
        </button>
        <button class="interaction-btn" id="sing-song-btn">
            <span style="color: #33ccff;">ğŸ¤</span> æ¼”å”±æ­Œæ›²
        </button>
        <button class="interaction-btn" id="cheer-btn">
            <span style="color: #ffcc00;">ğŸ‰</span> åº”æ´æ‰“call
        </button>
        <button class="interaction-btn" id="duet-btn">
            <span style="color: #ff66ff;">ğŸ¶</span> åˆå”±äº’åŠ¨
        </button>
    </div>
    
    <!-- æˆå°±å±•ç¤º -->
    <div class="achievement-show" id="achievementShow">
        <div class="achievement-title" id="achievementTitle"></div>
        <div class="achievement-desc" id="achievementDesc"></div>
        <div style="font-size: 48px;" id="achievementIcon"></div>
    </div>

    <script>
    // ========== æ¸¸æˆé…ç½® ==========
    const CONFIG = {
        maxParticles: 1000,
        particleLifetime: 200,
        aobaiPosition: { x: window.innerWidth * 0.2, y: window.innerHeight * 0.7 },
        leinPosition: { x: window.innerWidth * 0.8, y: window.innerHeight * 0.7 },
        interactionDistance: 150
    };
    
    // ========== æ¸¸æˆçŠ¶æ€ ==========
    let particles = [];
    let interactionCount = 0;
    let canvas, ctx;
    let gameState = {
        aobai: {
            energy: 100,
            fans: 1,
            singing: false,
            position: CONFIG.aobaiPosition
        },
        lein: {
            energy: 100,
            tickets: Infinity,
            cheering: false,
            position: CONFIG.leinPosition
        },
        relationshipLevel: 1,
        achievements: new Set()
    };
    
    // ========== å¯¹è¯ç³»ç»Ÿ ==========
    const DIALOGUES = {
        aobai: [
            "è°¢è°¢é›·æ©çš„æ”¯æŒï¼ğŸµ",
            "è¿™é¦–ã€Šå•µå•µèƒ½é‡ã€‹é€ç»™ä½ ï¼",
            "ä½ æ˜¯æœ€æ£’çš„ç²‰ä¸ï¼ğŸ’–",
            "è®©æˆ‘ä»¬ä¸€èµ·åˆå”±å§ï¼ğŸ¤",
            "å•µå•µ~ â¤ï¸"
        ],
        lein: [
            "é³Œæ‹œå§å§æˆ‘çˆ±ä½ ï¼ğŸ˜",
            "æˆ‘è¦å¬ä¸€ä¸‡åœºæ¼”å”±ä¼šï¼",
            "ä¸ºä½ æ‰“callä¸€è¾ˆå­ï¼ğŸŒŸ",
            "æ”¶é›†æ‰€æœ‰ä¸“è¾‘ï¼ğŸ’¿",
            "ä½ æ˜¯æˆ‘çš„å¶åƒï¼âœ¨"
        ]
    };
    
    // ========== ç²’å­ç³»ç»Ÿ ==========
    class Particle {
        constructor(x, y, type, targetX, targetY) {
            this.x = x;
            this.y = y;
            this.type = type;
            this.targetX = targetX;
            this.targetY = targetY;
            this.size = Math.random() * 10 + 5;
            this.speed = Math.random() * 3 + 2;
            this.life = CONFIG.particleLifetime;
            this.maxLife = CONFIG.particleLifetime;
            this.color = this.getColor();
            this.rotation = Math.random() * Math.PI * 2;
        }
        
        getColor() {
            switch(this.type) {
                case 'kiss': return '#ff3366';
                case 'music': return '#33ccff';
                case 'heart': return '#ff66cc';
                case 'star': return '#ffcc00';
                default: return '#ffffff';
            }
        }
        
        update() {
            // è®¡ç®—åˆ°ç›®æ ‡çš„å‘é‡
            const dx = this.targetX - this.x;
            const dy = this.targetY - this.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // é£å‘ç›®æ ‡
            if (distance > 10) {
                this.x += (dx / distance) * this.speed;
                this.y += (dy / distance) * this.speed;
            }
            
            // ç”Ÿå‘½å‘¨æœŸ
            this.life--;
            return this.life > 0 && distance > 5;
        }
        
        draw() {
            ctx.save();
            ctx.globalAlpha = this.life / this.maxLife;
            
            switch(this.type) {
                case 'kiss':
                    // å˜´å”‡ç²’å­
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    // å˜´å”‡ä¸­é—´
                    ctx.fillStyle = '#ff6699';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 0.6, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'music':
                    // éŸ³ç¬¦ç²’å­
                    ctx.fillStyle = this.color;
                    ctx.font = `${this.size * 2}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('â™ª', this.x, this.y);
                    break;
                    
                case 'heart':
                    // çˆ±å¿ƒç²’å­
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    for(let i=0; i<Math.PI*2; i+=0.01) {
                        const px = 16 * Math.pow(Math.sin(i), 3);
                        const py = -(13 * Math.cos(i) - 5*Math.cos(2*i) - 2*Math.cos(3*i) - Math.cos(4*i));
                        ctx.lineTo(this.x + px * this.size/30, this.y + py * this.size/30);
                    }
                    ctx.fill();
                    break;
                    
                case 'star':
                    // æ˜Ÿæ˜Ÿç²’å­
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    for(let i=0; i<5; i++) {
                        const angle = (i * Math.PI * 2) / 5;
                        const spike = this.size;
                        ctx.lineTo(
                            this.x + Math.cos(angle) * spike,
                            this.y + Math.sin(angle) * spike
                        );
                    }
                    ctx.closePath();
                    ctx.fill();
                    break;
            }
            
            ctx.restore();
        }
    }
    
    // ========== è§’è‰²äº’åŠ¨å‡½æ•° ==========
    function sendKiss() {
        // é›·æ©å‘é³Œæ‹œå‘é€å•µå•µ
        createParticles(
            gameState.lein.position.x,
            gameState.lein.position.y,
            'kiss',
            gameState.aobai.position.x,
            gameState.aobai.position.y,
            20
        );
        
        // æ›´æ–°çŠ¶æ€
        gameState.aobai.energy = Math.min(100, gameState.aobai.energy + 5);
        gameState.lein.energy = Math.max(0, gameState.lein.energy - 2);
        interactionCount++;
        
        // æ˜¾ç¤ºå¯¹è¯
        showDialogue('lein', "å•µå•µ~ ç»™é³Œæ‹œå§å§çš„çˆ±å¿ƒï¼ğŸ’‹");
        
        // æ£€æŸ¥æˆå°±
        checkAchievement('first_kiss', 'åˆå»', 'é€å‡ºç¬¬ä¸€ä¸ªå•µå•µ', 'ğŸ’‹');
    }
    
    function singSong() {
        // é³Œæ‹œæ¼”å”±æ­Œæ›²
        createParticles(
            gameState.aobai.position.x,
            gameState.aobai.position.y,
            'music',
            gameState.lein.position.x,
            gameState.lein.position.y,
            30
        );
        
        // é³Œæ‹œè·³èˆåŠ¨ç”»
        animateAobai('sing');
        
        // æ›´æ–°çŠ¶æ€
        gameState.lein.energy = Math.min(100, gameState.lein.energy + 10);
        gameState.aobai.energy = Math.max(0, gameState.aobai.energy - 5);
        gameState.aobai.fans++;
        
        // æ˜¾ç¤ºå¯¹è¯
        showDialogue('aobai', "çŒ®ä¸Šä¸€é¦–ã€Šå•µå•µèƒ½é‡ã€‹ï¼ğŸµ");
        
        // æ£€æŸ¥æˆå°±
        if (gameState.aobai.fans >= 10) {
            checkAchievement('popular', 'äººæ°”æ­Œæ‰‹', 'ç²‰ä¸è¾¾åˆ°10äºº', 'ğŸŒŸ');
        }
    }
    
    function cheer() {
        // é›·æ©åº”æ´æ‰“call
        createParticles(
            gameState.lein.position.x,
            gameState.lein.position.y,
            'star',
            gameState.aobai.position.x,
            gameState.aobai.position.y - 100,
            25
        );
        
        // é›·æ©è·³è·ƒåŠ¨ç”»
        animateLein('cheer');
        
        // æ›´æ–°çŠ¶æ€
        gameState.aobai.energy = Math.min(100, gameState.aobai.energy + 8);
        gameState.lein.energy = Math.max(0, gameState.lein.energy - 3);
        
        // æ˜¾ç¤ºå¯¹è¯
        showDialogue('lein', "é³Œæ‹œå§å§åŠ æ²¹ï¼ğŸ‰");
        
        // æ£€æŸ¥æˆå°±
        if (interactionCount >= 20) {
            checkAchievement('super_fan', 'è¶…çº§ç²‰ä¸', 'äº’åŠ¨è¾¾åˆ°20æ¬¡', 'ğŸ«');
        }
    }
    
    function duet() {
        // åˆå”±äº’åŠ¨
        createParticles(
            (gameState.aobai.position.x + gameState.lein.position.x) / 2,
            (gameState.aobai.position.y + gameState.lein.position.y) / 2 - 50,
            'heart',
            window.innerWidth / 2,
            window.innerHeight / 2,
            40
        );
        
        // åŒäººåŠ¨ç”»
        animateAobai('duet');
        animateLein('duet');
        
        // æ›´æ–°å…³ç³»ç­‰çº§
        gameState.relationshipLevel++;
        
        // æ›´æ–°çŠ¶æ€
        gameState.aobai.energy = Math.min(100, gameState.aobai.energy + 15);
        gameState.lein.energy = Math.min(100, gameState.lein.energy + 15);
        
        // æ˜¾ç¤ºå¯¹è¯
        showDialogue('aobai', "å’Œé›·æ©çš„å®Œç¾åˆå”±ï¼ğŸ¶");
        setTimeout(() => showDialogue('lein', "æœ€å¹¸ç¦çš„æ—¶åˆ»ï¼ğŸ˜­"), 1500);
        
        // æ£€æŸ¥æˆå°±
        if (gameState.relationshipLevel >= 5) {
            checkAchievement('best_duet', 'æœ€ä½³æ‹æ¡£', 'å…³ç³»ç­‰çº§è¾¾åˆ°5çº§', 'ğŸ‘¯');
        }
    }
    
    // ========== è¾…åŠ©å‡½æ•° ==========
    function createParticles(x, y, type, targetX, targetY, count) {
        for (let i = 0; i < count; i++) {
            if (particles.length < CONFIG.maxParticles) {
                particles.push(new Particle(
                    x + Math.random() * 40 - 20,
                    y + Math.random() * 40 - 20,
                    type,
                    targetX + Math.random() * 40 - 20,
                    targetY + Math.random() * 40 - 20
                ));
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆæç¤º
        playSound(type);
    }
    
    function showDialogue(character, text) {
        const bubble = document.getElementById(`${character}-dialogue`);
        bubble.textContent = text;
        bubble.style.opacity = '1';
        bubble.style.transform = 'translateY(0)';
        
        setTimeout(() => {
            bubble.style.opacity = '0';
            bubble.style.transform = 'translateY(20px)';
        }, 2000);
    }
    
    function animateAobai(action) {
        const aobai = document.getElementById('aobai');
        
        switch(action) {
            case 'sing':
                aobai.style.animation = 'bounce 0.5s ease 3';
                // ç”ŸæˆéŸ³ç¬¦
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const note = document.createElement('div');
                        note.className = 'music-note';
                        note.textContent = 'â™ª';
                        note.style.left = `${gameState.aobai.position.x + 50}px`;
                        note.style.top = `${gameState.aobai.position.y - 50}px`;
                        note.style.color = '#33ccff';
                        note.style.animationDelay = `${i * 0.2}s`;
                        document.body.appendChild(note);
                        
                        setTimeout(() => note.remove(), 2000);
                    }, i * 200);
                }
                break;
                
            case 'duet':
                aobai.style.animation = 'shake 0.5s ease 2';
                break;
        }
        
        setTimeout(() => aobai.style.animation = '', 2000);
    }
    
    function animateLein(action) {
        const lein = document.getElementById('lein');
        
        switch(action) {
            case 'cheer':
                lein.style.animation = 'bounce 0.3s ease 5';
                break;
                
            case 'duet':
                lein.style.animation = 'pulse 1s ease 2';
                break;
        }
        
        setTimeout(() => lein.style.animation = '', 2000);
    }
    
    function checkAchievement(id, title, desc, icon) {
        if (!gameState.achievements.has(id)) {
            gameState.achievements.add(id);
            
            const show = document.getElementById('achievementShow');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = desc;
            document.getElementById('achievementIcon').textContent = icon;
            
            show.classList.add('show');
            
            setTimeout(() => {
                show.classList.remove('show');
            }, 3000);
        }
    }
    
    function playSound(type) {
        // ç®€å•çš„éŸ³æ•ˆæç¤º
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        try {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'kiss':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    break;
                case 'music':
                    oscillator.frequency.value = 523.25; // C5
                    oscillator.type = 'sine';
                    break;
                case 'heart':
                    oscillator.frequency.value = 659.25; // E5
                    oscillator.type = 'sine';
                    break;
                case 'star':
                    oscillator.frequency.value = 783.99; // G5
                    oscillator.type = 'sine';
                    break;
            }
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        } catch (e) {
            // éŸ³é¢‘ä¸Šä¸‹æ–‡å¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œé™é»˜å¤±è´¥
        }
    }
    
    function updateUI() {
        document.getElementById('aobai-energy').textContent = Math.round(gameState.aobai.energy);
        document.getElementById('aobai-fans').textContent = gameState.aobai.fans;
        document.getElementById('lein-energy').textContent = Math.round(gameState.lein.energy);
        document.getElementById('lein-tickets').textContent = gameState.lein.tickets === Infinity ? 'âˆ' : gameState.lein.tickets;
        
        // æ›´æ–°èšå…‰ç¯
        document.getElementById('spotlight-aobai').style.left = `${gameState.aobai.position.x - 100}px`;
        document.getElementById('spotlight-lein').style.left = `${gameState.lein.position.x - 100}px`;
        
        // æ›´æ–°å¡ç‰‡è¾¹æ¡†å…‰æ•ˆ
        const aobaiCard = document.getElementById('aobai-card');
        const leinCard = document.getElementById('lein-card');
        
        aobaiCard.style.boxShadow = `0 0 20px ${gameState.aobai.energy > 50 ? '#ff3366' : '#ff6699'}`;
        leinCard.style.boxShadow = `0 0 20px ${gameState.lein.energy > 50 ? '#33ccff' : '#99ccff'}`;
        
        // æ›´æ–°è§’è‰²ä½ç½®åŠ¨ç”»
        document.getElementById('aobai').style.left = `${gameState.aobai.position.x - 60}px`;
        document.getElementById('lein').style.left = `${gameState.lein.position.x - 60}px`;
    }
    
    // ========== åŠ¨ç”»å¾ªç¯ ==========
    function animate() {
        // æ¸…ç©ºç”»å¸ƒ
        ctx.fillStyle = 'rgba(26, 11, 46, 0.1)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // ç»˜åˆ¶è¿æ¥çº¿
        drawConnectionLine();
        
        // æ›´æ–°å¹¶ç»˜åˆ¶ç²’å­
        particles = particles.filter(p => p.update());
        particles.forEach(p => p.draw());
        
        // ç»˜åˆ¶è§’è‰²
        drawCharacters();
        
        // æ›´æ–°UI
        updateUI();
        
        requestAnimationFrame(animate);
    }
    
    function drawConnectionLine() {
        const dx = gameState.lein.position.x - gameState.aobai.position.x;
        const dy = gameState.lein.position.y - gameState.aobai.position.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        // ç»˜åˆ¶èƒ½é‡è¿æ¥çº¿
        if (distance < 500) {
            ctx.save();
            const gradient = ctx.createLinearGradient(
                gameState.aobai.position.x, gameState.aobai.position.y,
                gameState.lein.position.x, gameState.lein.position.y
            );
            gradient.addColorStop(0, '#ff3366');
            gradient.addColorStop(1, '#33ccff');
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            ctx.globalAlpha = 0.5;
            
            ctx.beginPath();
            ctx.moveTo(gameState.aobai.position.x, gameState.aobai.position.y);
            ctx.lineTo(gameState.lein.position.x, gameState.lein.position.y);
            ctx.stroke();
            
            ctx.restore();
            
            // åœ¨è¿çº¿ä¸Šç»˜åˆ¶æµåŠ¨å…‰ç‚¹
            const progress = (Date.now() * 0.001) % 1;
            const pointX = gameState.aobai.position.x + dx * progress;
            const pointY = gameState.aobai.position.y + dy * progress;
            
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.shadowColor = '#ffffff';
            ctx.shadowBlur = 15;
            ctx.beginPath();
            ctx.arc(pointX, pointY, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }
    
    function drawCharacters() {
        // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„è§’è‰²ç»˜åˆ¶
        // ç›®å‰ä½¿ç”¨CSSç»˜åˆ¶çš„è§’è‰²ï¼Œè¿™é‡Œä¿æŒç©ºç™½æˆ–æ·»åŠ é¢å¤–æ•ˆæœ
    }
    
    // ========== åˆå§‹åŒ– ==========
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ¤ é³Œæ‹œæ¼”å”±ä¼šå‰§åœºå¯åŠ¨ä¸­...');
        
        // åˆå§‹åŒ–Canvas
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.getElementById('send-kiss-btn').addEventListener('click', sendKiss);
        document.getElementById('sing-song-btn').addEventListener('click', singSong);
        document.getElementById('cheer-btn').addEventListener('click', cheer);
        document.getElementById('duet-btn').addEventListener('click', duet);
        
        // è§¦æ‘¸äº‹ä»¶
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            
            // åˆ¤æ–­ç‚¹å‡»é è¿‘å“ªä¸ªè§’è‰²
            const clickX = touch.clientX;
            const clickY = touch.clientY;
            
            const distToAobai = Math.sqrt(
                Math.pow(clickX - gameState.aobai.position.x, 2) +
                Math.pow(clickY - gameState.aobai.position.y, 2)
            );
            
            const distToLein = Math.sqrt(
                Math.pow(clickX - gameState.lein.position.x, 2) +
                Math.pow(clickY - gameState.lein.position.y, 2)
            );
            
            if (distToAobai < 100) {
                sendKiss();
            } else if (distToLein < 100) {
                cheer();
            } else {
                // åœ¨ä¸­é—´ç‚¹å‡»åˆ›å»ºéšæœºç²’å­
                createParticles(
                    clickX, clickY, 
                    ['kiss', 'music', 'heart', 'star'][Math.floor(Math.random() * 4)],
                    window.innerWidth / 2, window.innerHeight / 2,
                    10
                );
            }
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            for (let touch of e.touches) {
                createParticles(
                    touch.clientX, touch.clientY,
                    'star',
                    gameState.aobai.position.x, gameState.aobai.position.y,
                    3
                );
            }
        });
        
        // é¼ æ ‡äº‹ä»¶
        canvas.addEventListener('mousedown', (e) => {
            const clickX = e.clientX;
            const clickY = e.clientY;
            
            const distToAobai = Math.sqrt(
                Math.pow(clickX - gameState.aobai.position.x, 2) +
                Math.pow(clickY - gameState.aobai.position.y, 2)
            );
            
            const distToLein = Math.sqrt(
                Math.pow(clickX - gameState.lein.position.x, 2) +
                Math.pow(clickY - gameState.lein.position.y, 2)
            );
            
            if (distToAobai < 100) {
                singSong();
            } else if (distToLein < 100) {
                duet();
            }
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) { // å·¦é”®æ‹–åŠ¨
                createParticles(
                    e.clientX, e.clientY,
                    'music',
                    gameState.lein.position.x, gameState.lein.position.y,
                    2
                );
            }
        });
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // æ›´æ–°è§’è‰²ä½ç½®
            gameState.aobai.position = { 
                x: window.innerWidth * 0.2, 
                y: window.innerHeight * 0.7 
            };
            gameState.lein.position = { 
                x: window.innerWidth * 0.8, 
                y: window.innerHeight * 0.7 
            };
        });
        
        // å¼€åœºåŠ¨ç”»
        setTimeout(() => {
            showDialogue('aobai', "æ¬¢è¿æ¥åˆ°æˆ‘çš„æ¼”å”±ä¼šï¼ğŸ¤");
            setTimeout(() => {
                showDialogue('lein', "é³Œæ‹œå§å§æˆ‘æ¥å•¦ï¼ğŸ˜");
                createParticles(
                    gameState.lein.position.x, gameState.lein.position.y,
                    'heart',
                    gameState.aobai.position.x, gameState.aobai.position.y,
                    30
                );
            }, 1000);
        }, 500);
        
        // å¯åŠ¨åŠ¨ç”»å¾ªç¯
        animate();
        
        console.log('âœ… æ¼”å”±ä¼šå‰§åœºå¯åŠ¨å®Œæˆï¼');
    });
    
    // æ·»åŠ CSSåŠ¨ç”»
    const style = document.createElement('style');
    style.textContent = `
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>
```
